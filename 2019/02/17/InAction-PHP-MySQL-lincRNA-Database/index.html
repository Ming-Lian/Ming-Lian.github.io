<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/Favico.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/Favico.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/Favico.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Part1：lincRNA注释信息数据库实现目标 将lincRNA的gtf格式的注释信息写到MySQL数据库中 用户需要登录才具有数据库访问权限 提供数据库的检索功能  思路 从 UCSC genome browser 或 Ensemble 等数据库中下载人类（homo sapiens）和小鼠 （Mus musculus）的全基因组注释信息文件(GTF或者GFF3格式文件）  提取出其中的linc">
<meta name="keywords" content="PHP,MySQL,CSS">
<meta property="og:type" content="article">
<meta property="og:title" content="PHP+MySQL实战：小鼠与人类lincRNA数据库">
<meta property="og:url" content="http://yoursite.com/2019/02/17/InAction-PHP-MySQL-lincRNA-Database/index.html">
<meta property="og:site_name" content="Lianm&#39;s Blog">
<meta property="og:description" content="Part1：lincRNA注释信息数据库实现目标 将lincRNA的gtf格式的注释信息写到MySQL数据库中 用户需要登录才具有数据库访问权限 提供数据库的检索功能  思路 从 UCSC genome browser 或 Ensemble 等数据库中下载人类（homo sapiens）和小鼠 （Mus musculus）的全基因组注释信息文件(GTF或者GFF3格式文件）  提取出其中的linc">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-download-1.png">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-arrow.jpg">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-download-2.png">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-arrow.jpg">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-download-3.png">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-arrow.jpg">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-download-4.png">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-gtf-format.png">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-arrow.jpg">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-register.png">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-login.png">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-loginsucc.png">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-query-form.png">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-part2-getdata-from-BioMart-1.png">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-part2-getdata-from-BioMart-2.png">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-part2-getdata-from-BioMart-3.png">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-part2-getdata-from-BioMart-4.png">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-part2-modify-phpscript-location.jpg">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-part3-login-ui.png">
<meta property="og:image" content="http://yoursite.com/images/InAction-PHP-MySQL-part3-page-with-navigation.png">
<meta property="og:updated_time" content="2019-04-04T02:15:43.107Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PHP+MySQL实战：小鼠与人类lincRNA数据库">
<meta name="twitter:description" content="Part1：lincRNA注释信息数据库实现目标 将lincRNA的gtf格式的注释信息写到MySQL数据库中 用户需要登录才具有数据库访问权限 提供数据库的检索功能  思路 从 UCSC genome browser 或 Ensemble 等数据库中下载人类（homo sapiens）和小鼠 （Mus musculus）的全基因组注释信息文件(GTF或者GFF3格式文件）  提取出其中的linc">
<meta name="twitter:image" content="http://yoursite.com/images/InAction-PHP-MySQL-download-1.png">






  <link rel="canonical" href="http://yoursite.com/2019/02/17/InAction-PHP-MySQL-lincRNA-Database/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>PHP+MySQL实战：小鼠与人类lincRNA数据库 | Lianm's Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Lianm's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Focus on Bioinformatics and Machine-Learning</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

  <a href="https://github.com/Ming-Lian" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/17/InAction-PHP-MySQL-lincRNA-Database/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lianm">
      <meta itemprop="description" content="中国科学院北京基因组研究所研究生">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lianm's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">PHP+MySQL实战：小鼠与人类lincRNA数据库

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-02-17 06:51:33" itemprop="dateCreated datePublished" datetime="2019-02-17T06:51:33+08:00">2019-02-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-04 10:15:43" itemprop="dateModified" datetime="2019-04-04T10:15:43+08:00">2019-04-04</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前后端技术/" itemprop="url" rel="index"><span itemprop="name">前后端技术</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Part1：lincRNA注释信息数据库"><a href="#Part1：lincRNA注释信息数据库" class="headerlink" title="Part1：lincRNA注释信息数据库"></a>Part1：lincRNA注释信息数据库</h1><h2 id="实现目标"><a href="#实现目标" class="headerlink" title="实现目标"></a>实现目标</h2><ul>
<li>将lincRNA的gtf格式的注释信息写到MySQL数据库中</li>
<li>用户需要登录才具有数据库访问权限</li>
<li>提供数据库的检索功能</li>
</ul>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ol>
<li><p>从 <strong>UCSC genome browser</strong> 或 <strong>Ensemble</strong> 等数据库中下载人类（homo sapiens）和小鼠 （Mus musculus）的全基因组注释信息文件(GTF或者GFF3格式文件）</p>
</li>
<li><p>提取出其中的lincRNA的注释信息记录，然后将其写入MySQL数据库系统</p>
</li>
<li><p>写好PHP脚本与之前建好的MySQL数据库系统进行数据交互</p>
</li>
</ol>
<h2 id="准备需要写入数据库中的数据"><a href="#准备需要写入数据库中的数据" class="headerlink" title="准备需要写入数据库中的数据"></a>准备需要写入数据库中的数据</h2><h3 id="下载注释信息文件"><a href="#下载注释信息文件" class="headerlink" title="下载注释信息文件"></a>下载注释信息文件</h3><p>获取GTF文件的下载地址：</p>
<p>打开Ensemble数据库：<a href="http://asia.ensembl.org/index.html" target="_blank" rel="noopener">http://asia.ensembl.org/index.html</a></p>
<p><img src="/images/InAction-PHP-MySQL-download-1.png" alt></p>
<p><img src="/images/InAction-PHP-MySQL-arrow.jpg" alt></p>
<p><img src="/images/InAction-PHP-MySQL-download-2.png" alt></p>
<p><img src="/images/InAction-PHP-MySQL-arrow.jpg" alt></p>
<p><img src="/images/InAction-PHP-MySQL-download-3.png" alt></p>
<p><img src="/images/InAction-PHP-MySQL-arrow.jpg" alt></p>
<p>以下列出了可供下载的基因组注释信息版本<code>release-XX</code>，目前的最新版本为<code>release-91</code></p>
<p><img src="/images/InAction-PHP-MySQL-download-4.png" alt></p>
<p>得到下载链接，开始下载（下载至Linux服务器中）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 下载GRCh38.91（人类）注释文件</span><br><span class="line">$ wget -c -P /Path/To/dir ftp://ftp.ensembl.org/pub/release-91/gtf/homo_sapiens/Homo_sapiens.GRCh38.91.gtf.gz</span><br><span class="line"></span><br><span class="line"># 下载GRCm38.91（小鼠）注释文件</span><br><span class="line">$ wget -c -P /Path/To/dir ftp://ftp.ensembl.org/pub/release-91/gtf/mus_musculus/Mus_musculus.GRCm38.91.gtf.gz</span><br></pre></td></tr></table></figure>
<h3 id="提取lincRNA部分记录"><a href="#提取lincRNA部分记录" class="headerlink" title="提取lincRNA部分记录"></a>提取lincRNA部分记录</h3><p>首先解压前面下载的压缩文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gunzip /Path/To/dir/Homo_sapiens.GRCh38.91.gtf.gz</span><br><span class="line">$ gunzip /Path/To/dir/Mus_musculus.GRCm38.91.gtf.gz</span><br></pre></td></tr></table></figure>
<p>GTF格式说明</p>
<p><img src="/images/InAction-PHP-MySQL-gtf-format.png" alt></p>
<p>看一下我们的GTF文件的具体情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Chrom	Resource	Feature	 Start	 End	Score	Strand	Frame 	Attributes</span><br><span class="line">1       havana  	gene    3073253 3074322 .       +       .       gene_id &quot;ENSMUSG00000102693&quot;; gene_version &quot;1&quot;; gene_name &quot;4933401J01Rik&quot;; gene_source &quot;havana&quot;; gene_biotype &quot;TEC&quot;; havana_gene &quot;OTTMUSG00000049935&quot;; havana_gene_version &quot;1&quot;;</span><br><span class="line">1       havana  	transcript      3073253 3074322 .       +       .       gene_id &quot;ENSMUSG00000102693&quot;; gene_version &quot;1&quot;; transcript_id &quot;ENSMUST00000193812&quot;; transcript_version &quot;1&quot;; gene_name &quot;4933401J01Rik&quot;; gene_source &quot;havana&quot;; gene_biotype &quot;TEC&quot;; havana_gene &quot;OTTMUSG00000049935&quot;; havana_gene_version &quot;1&quot;; transcript_name &quot;4933401J01Rik-201&quot;; transcript_source &quot;havana&quot;; transcript_biotype &quot;TEC&quot;; havana_transcript &quot;OTTMUST00000127109&quot;; havana_transcript_version &quot;1&quot;; tag &quot;basic&quot;; transcript_support_level &quot;NA&quot;;</span><br><span class="line">1       havana  	exon    3073253 3074322 .       +       .       gene_id &quot;ENSMUSG00000102693&quot;; gene_version &quot;1&quot;; transcript_id &quot;ENSMUST00000193812&quot;; transcript_version &quot;1&quot;; exon_number &quot;1&quot;; gene_name &quot;4933401J01Rik&quot;; gene_source &quot;havana&quot;; gene_biotype &quot;TEC&quot;; havana_gene &quot;OTTMUSG00000049935&quot;; havana_gene_version &quot;1&quot;; transcript_name &quot;4933401J01Rik-201&quot;; transcript_source &quot;havana&quot;; transcript_biotype &quot;TEC&quot;; havana_transcript &quot;OTTMUST00000127109&quot;; havana_transcript_version &quot;1&quot;; exon_id &quot;ENSMUSE00001343744&quot;; exon_version &quot;1&quot;; tag &quot;basic&quot;; transcript_support_level &quot;NA&quot;;</span><br></pre></td></tr></table></figure>
<p>可以看到，最后一列的<strong>gene_biotype</strong>中保存的是基因类型，例如protein_coding，lincRNA，miRNA等，所以针对这一列来提取</p>
<p>用Perl单行命令提取lincRNA注释记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ perl -ne &apos;chomp;next if (/^\#/);@gtf=split /\t/;if($gtf[8] =~ /gene_biotype\s\&quot;lincRNA\&quot;/) &#123;print &quot;$_\n&quot;;&#125;&apos; /Path/To/dir/Mus_musculus.GRCm38.91.gtf &gt;/Path/To/dir/lincRNA_GRCm38.91.gtf</span><br></pre></td></tr></table></figure>
<p>想获取该数据库实战中的示例数据，请点 <a href="https://github.com/Ming-Lian/Setup-Database/tree/master/txt-supply" target="_blank" rel="noopener"><strong>这里</strong></a></p>
<p>提取出来的lincRNA注释记录为以下形式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Chrom	Resource	Feature	 Start	 End	Score	Strand	Frame 	Attributes</span><br><span class="line">1       havana  	gene    29554   31109   .       +       .       gene_id &quot;ENSG00000243485&quot;; gene_version &quot;5&quot;; gene_name &quot;MIR1302-2HG&quot;; gene_source &quot;havana&quot;; gene_biotype &quot;lincRNA&quot;;</span><br><span class="line">1       havana  	transcript      29554   31097   .       +       .       gene_id &quot;ENSG00000243485&quot;; gene_version &quot;5&quot;; transcript_id &quot;ENST00000473358&quot;; transcript_version &quot;1&quot;; gene_name &quot;MIR1302-2HG&quot;; gene_source &quot;havana&quot;; gene_biotype &quot;lincRNA&quot;; transcript_name &quot;MIR1302-2HG-202&quot;; transcript_source &quot;havana&quot;; transcript_biotype &quot;lincRNA&quot;; tag &quot;basic&quot;; transcript_support_level &quot;5&quot;;</span><br><span class="line">1       havana  	exon    29554   30039   .       +       .       gene_id &quot;ENSG00000243485&quot;; gene_version &quot;5&quot;; transcript_id &quot;ENST00000473358&quot;; transcript_version &quot;1&quot;; exon_number &quot;1&quot;; gene_name &quot;MIR1302-2HG&quot;; gene_source &quot;havana&quot;; gene_biotype &quot;lincRNA&quot;; transcript_name &quot;MIR1302-2HG-202&quot;; transcript_source &quot;havana&quot;; transcript_biotype &quot;lincRNA&quot;; exon_id &quot;ENSE00001947070&quot;; exon_version &quot;1&quot;; tag &quot;basic&quot;; transcript_support_level &quot;5&quot;;</span><br></pre></td></tr></table></figure>
<p>接下来，将以上格式的信息格式化成以下形式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Chrom	Biotype	Feature	 	Start	 End	 GeneId		GeneName	TranscriptId		ExonNumber</span><br><span class="line"> 1	lincRNA	gene		29554	31109	ENSG00000243485	MIR1302-2HG	-			-</span><br><span class="line"> 1	lincRNA	transcript	29554	31097	ENSG00000243485	MIR1302-2HG	ENST00000473358		-</span><br><span class="line"> 1	lincRNA	exon		29554	30039	ENSG00000243485	MIR1302-2HG	ENST00000473358		1</span><br></pre></td></tr></table></figure>
<p>利用Perl的正则匹配提取目标字符串进行文本格式化，想了解正则表达式，请点 <a href="http://www.runoob.com/perl/perl-regular-expressions.html" target="_blank" rel="noopener">这里</a></p>
<blockquote>
<p>对于第三列Feature的不同，可以分别构造不同的正则表达式：</p>
<ul>
<li>gene：</li>
</ul>
<p>原格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; gene_id &quot;ENSG00000243485&quot;; gene_version &quot;5&quot;; gene_name &quot;MIR1302-2HG&quot;; gene_source &quot;havana&quot;; gene_biotype &quot;lincRNA&quot;;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>正则表达式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; /gene_id\s\&quot;(\w+)\&quot;;.&#123;18,19&#125;\sgene_name\s\&quot;([\w-\.]+)\&quot;/</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ul>
<li>transcript：</li>
</ul>
<p>原格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; gene_id &quot;ENSG00000243485&quot;; gene_version &quot;5&quot;; transcript_id &quot;ENST00000473358&quot;; transcript_version &quot;1&quot;; gene_name &quot;MIR1302-2HG&quot;; gene_source &quot;havana&quot;; gene_biotype &quot;lincRNA&quot;; transcript_name &quot;MIR1302-2HG-202&quot;; transcript_source &quot;havana&quot;; transcript_biotype &quot;lincRNA&quot;; tag &quot;basic&quot;; transcript_support_level &quot;5&quot;;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>正则表达式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; /gene_id\s\&quot;(\w+)\&quot;;.&#123;18,19&#125;\stranscript_id\s\&quot;(\w+)\&quot;;.&#123;24,25&#125;\sgene_name\s\&quot;([\w-\.]+)\&quot;/</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ul>
<li>exon：</li>
</ul>
<p>原格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; gene_id &quot;ENSG00000243485&quot;; gene_version &quot;5&quot;; transcript_id &quot;ENST00000473358&quot;; transcript_version &quot;1&quot;; exon_number &quot;1&quot;; gene_name &quot;MIR1302-2HG&quot;; gene_source &quot;havana&quot;; gene_biotype &quot;lincRNA&quot;; transcript_name &quot;MIR1302-2HG-202&quot;; transcript_source &quot;havana&quot;; transcript_biotype &quot;lincRNA&quot;; exon_id &quot;ENSE00001947070&quot;; exon_version &quot;1&quot;; tag &quot;basic&quot;; transcript_support_level &quot;5&quot;;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>正则表达式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; /gene_id\s\&quot;(\w+)\&quot;;.&#123;18,19&#125;\stranscript_id\s\&quot;(\w+)\&quot;;.&#123;24,25&#125;\sexon_number\s\&quot;(\d+)\&quot;;\sgene_name\s\&quot;([\w-\.]+)\&quot;/</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 正则匹配的正则表达式可能有点复杂，这里为了方便阅读分为多行且加上缩进，在实际命令行中请写成一行</span><br><span class="line"></span><br><span class="line">$ perl -ne &apos;chomp;next if (/^\#/);@linc=split /\t/;</span><br><span class="line">if($linc[2] =~ /gene/)&#123;</span><br><span class="line">	if ($linc[8] =~ /gene_id\s\&quot;(\w+)\&quot;;.&#123;18,19&#125;\sgene_name\s\&quot;([\w-\.]+)\&quot;/)&#123;</span><br><span class="line">		print &quot;$linc[0]\tlincRNA\t$linc[2]\t$linc[3]\t$linc[4]\t$1\t$2\t-\t-\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;elsif($linc[2] =~ /transcript/)&#123;</span><br><span class="line">	if($linc[8] =~ /gene_id\s\&quot;(\w+)\&quot;;.&#123;18,19&#125;\stranscript_id\s\&quot;(\w+)\&quot;;.&#123;24,25&#125;\sgene_name\s\&quot;([\w-\.]+)\&quot;/)</span><br><span class="line">	&#123;</span><br><span class="line">		print &quot;$linc[0]\tlincRNA\t$linc[2]\t$linc[3]\t$linc[4]\t$1\t$3\t$2\t-\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	if($linc[8] =~ /gene_id\s\&quot;(\w+)\&quot;;.&#123;18,19&#125;\stranscript_id\s\&quot;(\w+)\&quot;;.&#123;24,25&#125;\sexon_number\s\&quot;(\d+)\&quot;;\sgene_name\s\&quot;([\w-\.]+)\&quot;/)</span><br><span class="line">	&#123;</span><br><span class="line">		print &quot;$linc[0]\tlincRNA\t$linc[2]\t$linc[3]\t$linc[4]\t$1\t$4\t$2\t$3\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;&apos;</span><br><span class="line"></span><br><span class="line">/Path/To/dir/lincRNA_GRCm38.91.gtf &gt;/Path/To/dir/lincRNA_GRCm38.91.gtf.format</span><br></pre></td></tr></table></figure>
<h2 id="将数据写入数据库中"><a href="#将数据写入数据库中" class="headerlink" title="将数据写入数据库中"></a>将数据写入数据库中</h2><p>以下以将<code>lincRNA_GRCh38.91.gtf.format</code>的数据导入<code>lincRNA_h</code>表中为例</p>
<h3 id="方法一：使用MySQLi"><a href="#方法一：使用MySQLi" class="headerlink" title="方法一：使用MySQLi"></a>方法一：使用MySQLi</h3><p>MySQLi：PHP中用于与MySQL数据库系统进行数据库交互的扩展</p>
<p>使用MySQLi的预处理与参数绑定方法，进行数据的批量导入</p>
<p>预备知识：</p>
<blockquote>
<ul>
<li>想了解 MySQLi 连接数据库的方法，请点 <a href="https://github.com/Ming-Lian/Memo/blob/master/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9APHP%E4%B8%80%E5%91%A8%E9%80%9F%E6%88%90.md#connect-mysql-mysqli" target="_blank" rel="noopener">这里</a></li>
<li>想了解 MySQLi 的预处理方法，请点 <a href="https://github.com/Ming-Lian/Memo/blob/master/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9APHP%E4%B8%80%E5%91%A8%E9%80%9F%E6%88%90.md#use-prepare-sentence" target="_blank" rel="noopener">这里</a></li>
<li>想了解 PHP 的文件处理方法，请点 <a href="https://github.com/Ming-Lian/Memo/blob/master/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9APHP%E4%B8%80%E5%91%A8%E9%80%9F%E6%88%90.md#file-process" target="_blank" rel="noopener">这里</a></li>
</ul>
</blockquote>
<p>1. 首先，创建好表格</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 登录MySQL</span><br><span class="line">$ mysql -u username -p</span><br><span class="line"></span><br><span class="line"># 选定要操作的数据库，即打算将表格创建在哪个数据库底下，例如我们要操作的数据库为lincRNAdb</span><br><span class="line">mysql&gt; use lincRNAdb;</span><br><span class="line"></span><br><span class="line"># 创建表格，表格名为lincRNA_h</span><br><span class="line">mysql&gt; CREATE TABLE lincRNA_h (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `chrom` varchar(255) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;染色体&apos;,</span><br><span class="line">  `biotype` varchar(255) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;基因类型&apos;,</span><br><span class="line">  `feature` varchar(255) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;结构单元&apos;,</span><br><span class="line">  `start` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;起始位置&apos;,</span><br><span class="line">  `end` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;终止位置&apos;,</span><br><span class="line">  `geneid` varchar(255) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;基因ENsembleId&apos;,</span><br><span class="line">  `genename` varchar(255) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;基因名&apos;,</span><br><span class="line">  `transcriptid` varchar(255) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;转录本ENsembleId&apos;,</span><br><span class="line">  `exon` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;转录本exon序号&apos;,</span><br><span class="line">  PRIMARY KEY (`id`) </span><br><span class="line">) ;</span><br></pre></td></tr></table></figure>
<ul>
<li>编辑php脚本<code>lincRNA_Ano_data_batch_import.php</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$host=&quot;localhost&quot;;</span><br><span class="line"></span><br><span class="line">// 请设置好正确的用户名和密码，注意必须为具有数据库写权限的用户</span><br><span class="line">$username=&quot;root&quot;;</span><br><span class="line">$password=&quot;password&quot;;</span><br><span class="line"></span><br><span class="line">$dbname=&quot;testdb&quot;;</span><br><span class="line"></span><br><span class="line">// 连接数据库</span><br><span class="line">$conn=new mysqli($host,$username,$password,$dbname);</span><br><span class="line"></span><br><span class="line">// 检查连接</span><br><span class="line">if($conn-&gt;connect_error)&#123;</span><br><span class="line">	die(&quot;连接失败：&quot;.$conn-&gt;connect_error);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	echo &quot;连接成功！\n&quot;;</span><br><span class="line">	echo &quot;正在批量导入数据，请耐心等待...\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 预处理及绑定</span><br><span class="line">$stmt=$conn_prepare(&quot;INSERT INTO $argv[1] (chrom,biotype,feature,start,end,geneid,genename,transcriptid,exon) VALUES (?,?,?,?,?,?,?,?,?)&quot;) ;</span><br><span class="line">$stmt-&gt;bind_param(&quot;sssiisssi&quot;,$chrom,$biotype,$feature,$start,$end,$geneid,$genename,$transcriptid,$exon);</span><br><span class="line"></span><br><span class="line">// 打开文件</span><br><span class="line">$ file=fopen(&quot;$argv[2]&quot;,&apos;r&apos;) or exit(&quot;Unable to open file!&quot;);</span><br><span class="line"></span><br><span class="line">// 逐行读取文件，并写入数据库</span><br><span class="line">while(!feof($file))&#123;</span><br><span class="line">	$data=explode(&quot;\t&quot;,fgets($file)); // 以tab为间隔标识将字符串打散</span><br><span class="line">	</span><br><span class="line">	// 设置参数</span><br><span class="line">	$chrom=$data[0];</span><br><span class="line">	$biotype=$data[1];</span><br><span class="line">	$feature=$data[2];</span><br><span class="line">	$start=$data[3];</span><br><span class="line">	$end=$data[4];</span><br><span class="line">	$geneid=$data[5];</span><br><span class="line">	$genename=$data[6];</span><br><span class="line">	$transcriptid=$data[7];</span><br><span class="line">	$exon=$data[8];</span><br><span class="line">	// 执行</span><br><span class="line">	$stmt-&gt;execute();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo &quot;新记录插入成功&quot;;</span><br><span class="line"></span><br><span class="line">fcolse($file);</span><br><span class="line">$stmt-&gt;close();</span><br><span class="line">$conn-&gt;close();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>执行php脚本，完成数据的批量导入</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php -f lincRNA_Ano_data_batch_import.php &lt;tablename&gt; &lt;data-to-import&gt;</span><br></pre></td></tr></table></figure>
<p>想了解如何在 Linux 命令行中使用和执行 PHP 代码，请点 <a href="https://github.com/Ming-Lian/Memo/blob/master/Beginning-SQL.md#run-php-code-in-linux" target="_blank" rel="noopener">这里</a></p>
<h3 id="方法二：使用sql脚本"><a href="#方法二：使用sql脚本" class="headerlink" title="方法二：使用sql脚本"></a>方法二：使用sql脚本</h3><h4 id="准备sql脚本"><a href="#准备sql脚本" class="headerlink" title="准备sql脚本"></a>准备sql脚本</h4><p>要往MySQL数据库中写入数据，需要用<strong>INSERT INTO 语句</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO table_name (column1,column2,column3,...)</span><br><span class="line">VALUES (value1,value2,value3,...);</span><br></pre></td></tr></table></figure>
<p>一般情况下我们往数据库中写入少数几条数据时，直接在MySQL的交互环境中执行INSERT INTO 语句即可，但是当要批量导入时，再采用在MySQL的交互环境中执行INSERT INTO 语句，明显是低效而不现实的，这个时候我们可以写一个sql脚本，来执行数据库的批量操作。</p>
<p>简单来说sql脚本就是把多个INSERT INTO 语句写到一个文件里</p>
<p>sql脚本的文件起始部分（为人类和小鼠的数据分别准备一个sql文件，创建的对应表名分别为 lincRNA_h 和 lincRNA_m ，以下以人类的为例）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">SET NAMES utf8;</span><br><span class="line">SET FOREIGN_KEY_CHECKS = 0;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">--  Table structure for `lincRNA_h`</span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS `lincRNA_h`;</span><br><span class="line"></span><br><span class="line">CREATE TABLE lincRNA_h (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `chrom` varchar(255) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;染色体&apos;,</span><br><span class="line">  `biotype` varchar(255) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;基因类型&apos;,</span><br><span class="line">  `feature` varchar(255) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;结构单元&apos;,</span><br><span class="line">  `start` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;起始位置&apos;,</span><br><span class="line">  `end` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;终止位置&apos;,</span><br><span class="line">  `geneid` varchar(255) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;基因ENsembleId&apos;,</span><br><span class="line">  `genename` varchar(255) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;基因名&apos;,</span><br><span class="line">  `transcriptid` varchar(255) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;转录本ENsembleId&apos;,</span><br><span class="line">  `exon` int(11) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;转录本exon序号&apos;,</span><br><span class="line">  PRIMARY KEY (`id`) </span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">--  Records of `lincRNA_h`</span><br><span class="line">-- ----------------------------</span><br></pre></td></tr></table></figure>
<p>然后，用perl单行命令实现以下转换：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1	lincRNA	gene	29554	31109	ENSG00000243485	MIR1302-2HG	-	-</span><br></pre></td></tr></table></figure>
<p><img src="/images/InAction-PHP-MySQL-arrow.jpg" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO lincRNA_h （chrom,biotype,feature,start,end,geneid,genename,transcriptid,exon) VALUES (&quot;1&quot;,&quot;lincRNA&quot;,&quot;gene&quot;,&quot;29554&quot;,&quot;31109&quot;,&quot;ENSG00000243485&quot;,&quot;MIR1302-2HG&quot;,&quot;-&quot;,&quot;-&quot;);</span><br></pre></td></tr></table></figure>
<p>并将转换后的结果追加到上一步已经写好起始部分的sql脚本的后面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ perl -ane &apos;chomp;print &quot;INSERT INTO lincRNA_h (chrom,biotype,feature,start,end,geneid,genename,transcriptid,exon) VALUES (\&quot;$F[0]\&quot;,\&quot;$F[1]\&quot;,\&quot;$F[2]\&quot;,\&quot;$F[3]\&quot;,\&quot;$F[4]\&quot;,\&quot;$F[5]\&quot;,\&quot;$F[6]\&quot;,\&quot;$F[7]\&quot;,\&quot;$F[8]\&quot;);\n&quot;&apos; /Path/To/lincRNA_GRCh38.91.gtf.format &gt;&gt;/Path/To/lincRNA_h.sql</span><br></pre></td></tr></table></figure>
<h4 id="写入数据"><a href="#写入数据" class="headerlink" title="写入数据"></a>写入数据</h4><p>登录，进入MySQL的交互环境，才能进行以下操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 输入密码，登录MySQL</span><br><span class="line">$ mysql -u username -p</span><br><span class="line"></span><br><span class="line"># 查看已有的数据库</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line"></span><br><span class="line"># 选择要进行操作的数据库，比如我们要操作的数据库为lincRNAdb</span><br><span class="line">## 注意：请确认你具有该数据库的写入权限，否则无法写入</span><br><span class="line">mysql&gt; use lincRNAdb;</span><br><span class="line"></span><br><span class="line"># 执行sql脚本，向数据库中批量导入数据</span><br><span class="line">mysql&gt; source /Path/To/lincRNA_h.sql;</span><br><span class="line"></span><br><span class="line"># 查看当前使用的数据库中已有表格，确保数据已成功导入：是否有lincRNA_h表格？</span><br><span class="line">mysql&gt; show tables;</span><br><span class="line"></span><br><span class="line"># 查看表格中的数据是否正确，为了避免将表中的数据全部打印出来，请使用where子句，只打印出前100条记录</span><br><span class="line">mysql&gt; select * from lincRNA_h where id&lt;100;</span><br></pre></td></tr></table></figure>
<h2 id="编辑php脚本"><a href="#编辑php脚本" class="headerlink" title="编辑php脚本"></a>编辑php脚本</h2><h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><h4 id="创建注册页面"><a href="#创建注册页面" class="headerlink" title="创建注册页面"></a>创建注册页面</h4><p><img src="/images/InAction-PHP-MySQL-register.png" alt></p>
<p>表单部分的代码（想了解表单的相关知识，请点 <a href="https://github.com/Ming-Lian/Memo/blob/master/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9APHP%E4%B8%80%E5%91%A8%E9%80%9F%E6%88%90.md#form-and-input" target="_blank" rel="noopener">这里</a>）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;registeraction.php&quot; method=&quot;post&quot;&gt;</span><br><span class="line">&lt;table border=&quot;0&quot;&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;用户名：&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;&lt;input type=&quot;text&quot; id=&quot;id_name&quot; name=&quot;username&quot; required=&quot;required&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;密&amp;nbsp;&amp;nbsp;&amp;nbsp;码：&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;&lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; required=&quot;required&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;重复密码：&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;&lt;input type=&quot;password&quot; id=&quot;re_password&quot; name=&quot;re_password&quot; required=&quot;required&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;性别：&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;</span><br><span class="line">		&lt;input type=&quot;radio&quot; id=&quot;sex&quot; name=&quot;sex&quot; value=&quot;男&quot;&gt;男</span><br><span class="line">		&lt;input type=&quot;radio&quot; id=&quot;sex&quot; name=&quot;sex&quot; value=&quot;女&quot;&gt;女</span><br><span class="line">	&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;QQ：&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;&lt;input type=&quot;text&quot; id=&quot;qq&quot; name=&quot;qq&quot; required=&quot;required&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;Email：&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;&lt;input type=&quot;email&quot; id=&quot;email&quot; name=&quot;email&quot; required=&quot;required&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;电话：&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;&lt;input type=&quot;text&quot; id=&quot;phone&quot; name=&quot;phone&quot; required=&quot;required&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;地址：&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;&lt;input type=&quot;text&quot; id=&quot;address&quot; name=&quot;address&quot; required=&quot;required&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td colspan=&quot;2&quot; align=&quot;center&quot; style=&quot;color:red;font-size:10px;&quot;&gt;</span><br><span class="line">&lt;!--提示信息--&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$err=isset($_GET[&quot;err&quot;])?$_GET[&quot;err&quot;]:&quot;&quot;;</span><br><span class="line">switch($err) &#123;</span><br><span class="line">	case 1:</span><br><span class="line">		echo &quot;用户名已存在！&quot;;</span><br><span class="line"> 		break;</span><br><span class="line">	case 2:</span><br><span class="line">		echo &quot;密码与重复密码不一致！&quot;;</span><br><span class="line">		break;</span><br><span class="line">	case 3:</span><br><span class="line">		echo &quot;注册成功！&quot;;</span><br><span class="line">		break;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;</span><br><span class="line">		&lt;input type=&quot;submit&quot; id=&quot;register&quot; name=&quot;register&quot; value=&quot;注册&quot;&gt;</span><br><span class="line">		&lt;input type=&quot;reset&quot; id=&quot;reset&quot; name=&quot;reset&quot; value=&quot;重置&quot;&gt;</span><br><span class="line">	&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;如果已有账号，快去&lt;a href=&quot;login.php&quot;&gt;登录&lt;/a&gt;吧！&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<p>表单信息提交的对象为同一目录下的<code>registeraction.php</code>脚本</p>
<h4 id="注册信息处理脚本"><a href="#注册信息处理脚本" class="headerlink" title="注册信息处理脚本"></a>注册信息处理脚本</h4><p><code>registeraction.php</code>脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// 声明变量</span><br><span class="line"></span><br><span class="line">$username = isset($_POST[&apos;username&apos;])?$_POST[&apos;username&apos;]:&quot;&quot;;</span><br><span class="line">$password = isset($_POST[&apos;password&apos;])?$_POST[&apos;password&apos;]:&quot;&quot;;</span><br><span class="line">$re_password = isset($_POST[&apos;re_password&apos;])?$_POST[&apos;re_password&apos;]:&quot;&quot;;</span><br><span class="line">$sex = isset($_POST[&apos;sex&apos;])?$_POST[&apos;sex&apos;]:&quot;&quot;;</span><br><span class="line">$qq = isset($_POST[&apos;qq&apos;])?$_POST[&apos;qq&apos;]:&quot;&quot;;</span><br><span class="line">$email = isset($_POST[&apos;email&apos;])?$_POST[&apos;email&apos;]:&quot;&quot;;</span><br><span class="line">$phone = isset($_POST[&apos;phone&apos;])?$_POST[&apos;phone&apos;]:&quot;&quot;;</span><br><span class="line">$address = isset($_POST[&apos;address&apos;])?$_POST[&apos;address&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">if($password == $re_password) &#123;</span><br><span class="line">	// 建立连接，需要以root的身份登录MySQL，因为只有root用户才具有数据库的写权限</span><br><span class="line">	// 使用面向对象的MySQLi方法</span><br><span class="line">	$conn = new mysqli(&apos;localhost&apos;,&apos;root&apos;,&apos;&apos;,&apos;php&apos;); // 第三项需填入root用户的密码，若设置为免密登录，则可以为空</span><br><span class="line">	// 准备SQL语句,查询用户名</span><br><span class="line">	$sql_select=&quot;SELECT username FROM User WHERE username = &apos;$username&apos;&quot;;</span><br><span class="line">	// 执行SQL语句</span><br><span class="line">	$result = $conn-&gt;query($sql_select);</span><br><span class="line">	$row = $result-&gt;fetch_array();</span><br><span class="line">	// 判断用户名是否已存在</span><br><span class="line">	if($username == $row[&apos;username&apos;]) &#123;</span><br><span class="line">		//用户名已存在，显示提示信息</span><br><span class="line">		header(&quot;Location:register.php?err=1&quot;);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line"></span><br><span class="line">		//用户名不存在，插入数据</span><br><span class="line">		//准备SQL语句</span><br><span class="line">		$sql_insert = &quot;INSERT INTO User(username,password,sex,qq,email,phone,address) VALUES(&apos;$username&apos;,&apos;$password&apos;,&apos;$sex&apos;,&apos;$qq&apos;,&apos;$email&apos;,&apos;$phone&apos;,&apos;$address&apos;)&quot;;</span><br><span class="line">		//执行SQL语句</span><br><span class="line">		$conn-&gt;query($sql_insert);</span><br><span class="line">		header(&quot;Location:register.php?err=3&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//关闭数据库</span><br><span class="line">	$conn-&gt;close($conn);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">	header(&quot;Location:register.php?err=2&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><h4 id="登录页面"><a href="#登录页面" class="headerlink" title="登录页面"></a>登录页面</h4><p><img src="/images/InAction-PHP-MySQL-login.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;form id=&quot;loginform&quot; action=&quot;loginaction.php&quot; method=&quot;post&quot;&gt;</span><br><span class="line">&lt;table border=&quot;0&quot;&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;用户名：&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;&lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;username&quot; required=&quot;required&quot; value=&quot;&lt;?php echo isset($_COOKIE[&quot;wang&quot;])?$_COOKIE[&quot;wang&quot;]:&quot;&quot;;?&gt;&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;密&amp;nbsp;&amp;nbsp;&amp;nbsp;码：&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;&lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td colspan=&quot;2&quot;&gt;&lt;input type=&quot;checkbox&quot; name=&quot;remember&quot; value=&quot;on&quot;&gt;&lt;small&gt;记住我&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td colspan=&quot;2&quot; align=&quot;center&quot; style=&quot;color:red;font-size:10px;&quot;&gt;</span><br><span class="line">&lt;!--提示信息--&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$err=isset($_GET[&quot;err&quot;])?$_GET[&quot;err&quot;]:&quot;&quot;;</span><br><span class="line">switch($err) &#123;</span><br><span class="line">case 1:</span><br><span class="line">	echo &quot;用户名或密码错误！&quot;;</span><br><span class="line">	break;</span><br><span class="line">case 2:</span><br><span class="line">	echo &quot;用户名或密码不能为空！&quot;;</span><br><span class="line">	break;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">	&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;</span><br><span class="line">		&lt;input type=&quot;submit&quot; id=&quot;login&quot; name=&quot;login&quot; value=&quot;登录&quot;&gt;</span><br><span class="line">		&lt;input type=&quot;reset&quot; id=&quot;reset&quot; name=&quot;reset&quot; value=&quot;重置&quot;&gt;</span><br><span class="line">	&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;还没有账号，快去&lt;a href=&quot;register.php&quot;&gt;注册&lt;/a&gt;吧！&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<h4 id="登录脚本"><a href="#登录脚本" class="headerlink" title="登录脚本"></a>登录脚本</h4><p><a name="login-php-1">方法一：</a></p>
<p>该方法为，用root用户权限从User表中提取相应的用户名和密码信息，与用户填写的用户名和密码进行比较，来判断用户用户是否拥有数据库的访问权限</p>
<p>该方法需要拥有root用户的账户密码，若没有，请使用第二种方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// 声明变量</span><br><span class="line">$username = isset($_POST[&apos;username&apos;])?$_POST[&apos;username&apos;]:&quot;&quot;;</span><br><span class="line">$password = isset($_POST[&apos;password&apos;])?$_POST[&apos;password&apos;]:&quot;&quot;;</span><br><span class="line">$remember = isset($_POST[&apos;remember&apos;])?$_POST[&apos;remember&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">// 判断用户名和密码是否为空</span><br><span class="line">if(!empty($username)&amp;&amp;!empty($password)) &#123;</span><br><span class="line">	// 建立连接</span><br><span class="line">	// 使用面向对象的方法</span><br><span class="line">	$conn = new mysqli(&apos;localhost&apos;,&apos;root&apos;,&apos;&apos;,&apos;php&apos;);</span><br><span class="line">	// 准备SQL语句</span><br><span class="line">	$sql_select = &quot;SELECT user,password FROM User WHERE user = &apos;$username&apos; AND password = &apos;$password&apos;&quot;;</span><br><span class="line">	//执行SQL语句</span><br><span class="line">	$result = $conn-&gt;query($sql_select);</span><br><span class="line"></span><br><span class="line">	$row = $result-&gt;fetch_assoc();</span><br><span class="line"></span><br><span class="line">	//判断用户名或密码是否正确</span><br><span class="line">	if($username==$row[&apos;username&apos;]&amp;&amp;$password==$row[&apos;password&apos;]) &#123;</span><br><span class="line">		//选中“记住我”</span><br><span class="line">		if($remember==&quot;on&quot;) &#123;</span><br><span class="line">			//创建cookie</span><br><span class="line">			setcookie(&quot;wang&quot;, $username, time()+7*24*3600);</span><br><span class="line">		&#125;</span><br><span class="line">		//开启session</span><br><span class="line">		session_start();</span><br><span class="line">		//创建session</span><br><span class="line">		$_SESSION[&apos;user&apos;]=$username;</span><br><span class="line">		$_SESSION[&apos;password&apos;]=$password;</span><br><span class="line">		//写入日志</span><br><span class="line">		$ip = $_SERVER[&apos;REMOTE_ADDR&apos;];</span><br><span class="line">		$date = date(&apos;Y-m-d H:m:s&apos;);</span><br><span class="line"></span><br><span class="line">		$info = sprintf(&quot;当前访问用户：%s,IP地址：%s,时间：%s \n&quot;,$username, $ip, $date);</span><br><span class="line">		$sql_logs = &quot;INSERT INTO Logs(username,ip,date) VALUES(&apos;$username&apos;,&apos;$ip&apos;,&apos;$date&apos;)&quot;;</span><br><span class="line"></span><br><span class="line">		//日志写入文件，如实现此功能，需要创建文件目录logs</span><br><span class="line">		$f = fopen(&apos;./logs/&apos;.date(&apos;Ymd&apos;).&apos;.log&apos;,&apos;a+&apos;);</span><br><span class="line"></span><br><span class="line">		fwrite($f,$info);</span><br><span class="line">		fclose($f);</span><br><span class="line"></span><br><span class="line">		//跳转到loginsucc.php页面</span><br><span class="line">		header(&quot;Location:loginsucc.php&quot;);</span><br><span class="line">		//关闭数据库</span><br><span class="line">		$conn-&gt;close();</span><br><span class="line">	&#125;else &#123;</span><br><span class="line">		//用户名或密码错误，赋值err为1</span><br><span class="line">		header(&quot;Location:login.php?err=1&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;else &#123;</span><br><span class="line">	//用户名或密码为空，赋值err为2</span><br><span class="line">	header(&quot;Location:login.php?err=2&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p><a name="login-php-2">方法二：</a></p>
<p>该方法通过使用用户填写的用户名和密码直接尝试登陆MySQL，通过登录结果来判断用户是否拥有数据库的使用权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// 声明变量</span><br><span class="line">$username = isset($_POST[&apos;username&apos;])?$_POST[&apos;username&apos;]:&quot;&quot;;</span><br><span class="line">$password = isset($_POST[&apos;password&apos;])?$_POST[&apos;password&apos;]:&quot;&quot;;</span><br><span class="line">$remember = isset($_POST[&apos;remember&apos;])?$_POST[&apos;remember&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">// 判断用户名和密码是否为空</span><br><span class="line">if(!empty($username)&amp;&amp;!empty($password)) &#123;</span><br><span class="line">	// 建立连接</span><br><span class="line">	// 使用面向对象的方法，使用用户填写的用户名和密码直接尝试登陆MySQL</span><br><span class="line">	$conn = new mysqli(&apos;localhost&apos;,$username,$password,&apos;testdb&apos;);</span><br><span class="line">	</span><br><span class="line">	if ($conn-&gt;connect_error) &#123;</span><br><span class="line">		// 连接失败，用户名或密码错误，赋值err为1</span><br><span class="line">		header(&quot;Location:login.php?err=1&quot;);</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		//选中“记住我”</span><br><span class="line">		if($remember==&quot;on&quot;) &#123;</span><br><span class="line">			//创建cookie</span><br><span class="line">			setcookie(&quot;wang&quot;, $username, time()+7*24*3600);</span><br><span class="line">		&#125;</span><br><span class="line">		//开启session</span><br><span class="line">		session_start();</span><br><span class="line">		//创建session</span><br><span class="line">		$_SESSION[&apos;user&apos;]=$username;</span><br><span class="line">		$_SESSION[&apos;password&apos;]=$password;</span><br><span class="line"></span><br><span class="line">		//跳转到loginsucc.php页面</span><br><span class="line">		header(&quot;Location:loginsucc.php&quot;);</span><br><span class="line">		//关闭数据库</span><br><span class="line">		$conn-&gt;close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;else &#123;</span><br><span class="line">	//用户名或密码为空，赋值err为2</span><br><span class="line">	header(&quot;Location:login.php?err=2&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h4 id="登录成功"><a href="#登录成功" class="headerlink" title="登录成功"></a>登录成功</h4><p><img src="/images/InAction-PHP-MySQL-loginsucc.png" alt></p>
<p>通过判断全局变量<code>$_SESSION[&#39;user&#39;]</code>是否定义来判断是否成功登录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//开启session</span><br><span class="line">session_start();</span><br><span class="line">//声明变量</span><br><span class="line">$username= isset($_SESSION[&apos;user&apos;])?$_SESSION[&apos;user&apos;]:&quot;&quot;;</span><br><span class="line">//判断session是否为空</span><br><span class="line">if(!empty($username))&#123;</span><br><span class="line">?&gt;</span><br><span class="line">	&lt;h1&gt;登录成功！&lt;/h1&gt;</span><br><span class="line">	欢迎您！</span><br><span class="line">&lt;?php</span><br><span class="line">	echo $username;</span><br><span class="line">?&gt;</span><br><span class="line">	// 继续检索数据库</span><br><span class="line">	&lt;br/&gt;</span><br><span class="line">	&lt;a href=&quot;databaseQuery_Ano.php&quot;&gt;检索数据库&lt;/a&gt;</span><br><span class="line">	&lt;br/&gt;</span><br><span class="line">	&lt;a href=&quot;logout.php&quot;&gt;退出&lt;/a&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">&#125;else &#123;</span><br><span class="line">	//未登录，无权访问</span><br><span class="line">	?&gt;</span><br><span class="line">	&lt;h1&gt;你无权访问！！！&lt;/h1&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h4 id="退出登录"><a href="#退出登录" class="headerlink" title="退出登录"></a>退出登录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//开启session</span><br><span class="line">session_start();</span><br><span class="line">//撤销session</span><br><span class="line">session_unset();</span><br><span class="line">session_destroy();</span><br><span class="line">//跳转到login.php</span><br><span class="line">header(&quot;Location:login.php&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h3 id="检索数据库"><a href="#检索数据库" class="headerlink" title="检索数据库"></a>检索数据库</h3><p>检索数据库，需要用到数据库用户的<strong>用户名</strong>和<strong>密码</strong>，用于在之前的登录过程中，我们已经将用户名和密码存储在 $_SESSION 中，所以可以通过 <code>$_SESSION[&#39;user&#39;]</code> 和 <code>$_SESSION[&#39;password&#39;]</code> 获得</p>
<p>这里将表单部分与PHP命令写在一个PHP脚本中，脚本命名为<code>databaseQuery_Ano.php</code></p>
<h4 id="表单部分"><a href="#表单部分" class="headerlink" title="表单部分"></a>表单部分</h4><p><img src="/images/InAction-PHP-MySQL-query-form.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;#&quot; method=&quot;post&quot;&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td align=&quot;left&quot;&gt;物&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp种：&lt;/td&gt;</span><br><span class="line">	&lt;td colspan=&quot;2&quot; align=&quot;left&quot;&gt;</span><br><span class="line">		&lt;select name=&quot;specie&quot;&gt;</span><br><span class="line">			&lt;option value=&quot;&quot;&gt;选择一个物种:&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;human&quot;&gt;Homo Sapiens&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;mouse&quot;&gt;Mus musculus&lt;/option&gt;</span><br><span class="line">		&lt;/select&gt;</span><br><span class="line">	&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td align=&quot;left&quot;&gt;基因名/基因ID:&lt;/td&gt;</span><br><span class="line">	&lt;td colspan=&quot;2&quot; align=&quot;left&quot;&gt;&lt;input type=&quot;text&quot; name=&quot;geneName&quot; value=&quot;MIR1302-2HG&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td align=&quot;left&quot;&gt;基&amp;nbsp;&amp;nbsp;&amp;nbsp因&amp;nbsp;&amp;nbsp;&amp;nbsp位&amp;nbsp;&amp;nbsp;&amp;nbsp置：&lt;/td&gt;</span><br><span class="line">	&lt;td colspan=&quot;2&quot; align=&quot;left&quot;&gt;</span><br><span class="line">		&lt;select name=&quot;chrom&quot;&gt;</span><br><span class="line">			&lt;option value=&quot;&quot;&gt;选择一条染色体：&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;1&quot;&gt;chr1&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;2&quot;&gt;chr2&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;3&quot;&gt;chr3&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;4&quot;&gt;chr4&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;5&quot;&gt;chr5&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;6&quot;&gt;chr6&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;7&quot;&gt;chr7&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;8&quot;&gt;chr8&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;9&quot;&gt;chr9&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;10&quot;&gt;chr10&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;11&quot;&gt;chr11&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;12&quot;&gt;chr12&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;13&quot;&gt;chr13&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;14&quot;&gt;chr14&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;15&quot;&gt;chr15&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;16&quot;&gt;chr16&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;17&quot;&gt;chr17&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;18&quot;&gt;chr18&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;19&quot;&gt;chr19&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;20&quot;&gt;chr20&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;21&quot;&gt;chr21&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;22&quot;&gt;chr22&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;X&quot;&gt;chrX&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;Y&quot;&gt;chrY&lt;/option&gt;</span><br><span class="line">		&lt;/select&gt;	</span><br><span class="line">	&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;</span><br><span class="line">		区间：&lt;input type=&quot;text&quot; name=&quot;start&quot;&gt; - &lt;input type=&quot;text&quot; name=&quot;end&quot;&gt;</span><br><span class="line">	&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td colspan=&quot;2&quot; align=&quot;center&quot; style=&quot;color:red;font-size:10px;&quot;&gt;</span><br><span class="line">&lt;!--提示信息--&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$err=isset($_GET[&quot;err&quot;])?$_GET[&quot;err&quot;]:&quot;&quot;;</span><br><span class="line">switch($err) &#123;</span><br><span class="line">case 1:</span><br><span class="line">	echo &quot;表单填写错误:物种必须选，基因名和基因位置两项至少选一项填写！&quot;;</span><br><span class="line">	break;</span><br><span class="line">case 2:</span><br><span class="line">	echo &quot;表单填写错误：区间起始和终止位置需为整数，且起始位置小于终止位置！&quot;;</span><br><span class="line">	break;</span><br><span class="line">case 3:</span><br><span class="line">	echo &quot;未登陆，无权访问！&lt;br&gt;&quot;;</span><br><span class="line">	echo &quot;快去&lt;a href=&apos;login.php&apos;&gt;登录&lt;/a&gt;吧&quot;;</span><br><span class="line">	break;</span><br><span class="line">case 4:</span><br><span class="line">	echo &quot;Update或Delete操作异常！未在数据库中找到对应记录！&quot;;</span><br><span class="line">	break;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">	&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td align=&quot;center&quot;&gt;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Submit&quot;&gt;&lt;/td&gt;</span><br><span class="line">	&lt;td align=&quot;center&quot;&gt;&lt;input type=&quot;reset&quot; value=&quot;Reset&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<h4 id="PHP脚本"><a href="#PHP脚本" class="headerlink" title="PHP脚本"></a>PHP脚本</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//开启session</span><br><span class="line">session_start();</span><br><span class="line">// 获取用户名和密码</span><br><span class="line">$username=isset($_SESSION[&apos;user&apos;])?$_SESSION[&apos;user&apos;]:&quot;&quot;;</span><br><span class="line">$password=isset($_SESSION[&apos;password&apos;])?$_SESSION[&apos;password&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">// 获取表单提交数据</span><br><span class="line">$specie=isset($_POST[&apos;specie&apos;])?$_POST[&apos;specie&apos;]:&quot;&quot;;</span><br><span class="line">$geneName=isset($_POST[&apos;geneName&apos;])?$_POST[&apos;geneName&apos;]:&quot;&quot;;</span><br><span class="line">$chrom=isset($_POST[&apos;chrom&apos;])?$_POST[&apos;chrom&apos;]:&quot;&quot;;</span><br><span class="line">$start=isset($_POST[&apos;start&apos;])?$_POST[&apos;start&apos;]:&quot;&quot;;</span><br><span class="line">$end=isset($_POST[&apos;end&apos;])?$_POST[&apos;end&apos;]:&quot;&quot;;</span><br><span class="line">$submit=isset($_POST[&apos;submit&apos;])?$_POST[&apos;submit&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">if($submit)&#123;</span><br><span class="line">	// 判断提交的检索信息是否满足要求：物种必须选，基因名和基因位置两项至少选一项填写</span><br><span class="line">	if(empty($specie)||(empty($geneName)&amp;&amp;empty($chrom)))&#123;</span><br><span class="line">		header(&quot;Location:databaseQuery.php?err=1&quot;);</span><br><span class="line"></span><br><span class="line">	// 判断用户名和密码是否已经设置</span><br><span class="line">	&#125;elseif(!empty($username)&amp;&amp;!empty($password))&#123;</span><br><span class="line">		// 连接数据库</span><br><span class="line">		$conn=new mysqli(&apos;localhost&apos;,$username,$password,&apos;testdb&apos;);</span><br><span class="line">		if($conn-&gt;connect_error)&#123;</span><br><span class="line">			header(&quot;Location:databaseQuery_Ano.php?err=3&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		// 设置要检索的数据库表格名</span><br><span class="line">		$table=&quot;&quot;;</span><br><span class="line">		if($specie==&quot;human&quot;)&#123;</span><br><span class="line">			$table=&quot;lincRNA_h&quot;;</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">			$table=&quot;lincRNA_m&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		// 创建SQL查询语句</span><br><span class="line">		$sql=&quot;SELECT * from $table where&quot;;</span><br><span class="line">		// 根据实际表单填写情况追加查询条件</span><br><span class="line">		$bool_and=false;</span><br><span class="line">		if(!empty($geneName))&#123;</span><br><span class="line">			$sql .= &quot; genename=&apos;$geneName&apos; or geneid=&apos;$geneName&apos;&quot;;</span><br><span class="line">			$bool_and=true;</span><br><span class="line">		&#125;</span><br><span class="line">		if(!empty($chrom))&#123;</span><br><span class="line">			if($bool_and)&#123;</span><br><span class="line">				$sql .= &quot; and&quot;;</span><br><span class="line">			&#125;</span><br><span class="line">			$sql .= &quot; chrom=&apos;$chrom&apos;&quot;;</span><br><span class="line">			if(!empty($start)&amp;&amp;!empty($end))&#123;</span><br><span class="line">				// 判断提交的起始点与终止点是否正确，即是否为整数，且起始点小于终止点</span><br><span class="line">				if(is_int(intval($start))&amp;&amp;is_int(intval($end))&amp;&amp;intval($start)&lt;intval($end))&#123;</span><br><span class="line">					$sql .= &quot; and start&gt;=$start and end&lt;=$end&quot;;</span><br><span class="line">				&#125;else&#123;</span><br><span class="line">					header(&quot;Location:databaseQuery_Ano.php?err=2&quot;);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;				</span><br><span class="line">		&#125;</span><br><span class="line">		$sql .= &quot;;&quot;;</span><br><span class="line">	</span><br><span class="line">		// 执行查询语句</span><br><span class="line">		$result=$conn-&gt;query($sql);</span><br><span class="line">	</span><br><span class="line">		</span><br><span class="line">	</span><br><span class="line">		if($result-&gt;num_rows &gt; 0)&#123;</span><br><span class="line">			// 输出查询结果</span><br><span class="line">			echo &quot;&lt;table &gt;&lt;tr&gt;&lt;th&gt;chrom&lt;/th&gt;&lt;th&gt;Biotype&lt;/th&gt;&lt;th&gt;Feature&lt;/th&gt;&lt;th&gt;Start&lt;/th&gt;&lt;th&gt;End&lt;/th&gt;&lt;th&gt;GeneId&lt;/th&gt;&lt;th&gt;GeneName&lt;/th&gt;&lt;th&gt;TranscriptId&lt;/th&gt;&lt;th&gt;ExonNumber&lt;/th&gt;&lt;th&gt;操作&lt;/th&gt;&lt;/tr&gt;&quot;;</span><br><span class="line">			</span><br><span class="line">			while($row = $result-&gt;fetch_array())&#123;</span><br><span class="line">				echo &quot;&lt;tr&gt;&lt;td&gt;&quot;.$row[&apos;chrom&apos;].&quot;&lt;/td&gt;&lt;td&gt;&quot;.$row[&apos;biotype&apos;].&quot;&lt;/td&gt;&lt;td&gt;&quot;.$row[&apos;feature&apos;].&quot;&lt;/td&gt;&lt;td&gt;&quot;.$row[&apos;start&apos;].&quot;&lt;/td&gt;&lt;td&gt;&quot;.$row[&apos;end&apos;].&quot;&lt;/td&gt;&lt;td&gt;&quot;.$row[&apos;geneid&apos;].&quot;&lt;/td&gt;&lt;td&gt;&quot;.$row[&apos;genename&apos;].&quot;&lt;/td&gt;&lt;td&gt;&quot;.$row[&apos;transcriptid&apos;].&quot;&lt;/td&gt;&lt;td&gt;&quot;.$row[&apos;exon&apos;].&quot;&lt;/td&gt;&lt;td&gt;&lt;a style=\&quot;padding:2px;\&quot; href=\&quot;update_form.php?id=&quot;.$row[&apos;id&apos;].&quot;&amp;dbname=&quot;.$table.&quot;\&quot;&gt;Update&lt;/a&gt;&lt;/tr&gt;&quot;;</span><br><span class="line">    		&#125;</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">    		echo &quot;未检索到满足条件的记录!&quot;;</span><br><span class="line">    	&#125;</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		// 跳转到当前页面，并为err赋值1</span><br><span class="line">		header(&quot;Location:databaseQuery_Ano.php?err=3&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h1 id="Part2：内容与功能升级"><a href="#Part2：内容与功能升级" class="headerlink" title="Part2：内容与功能升级"></a>Part2：内容与功能升级</h1><h2 id="实现目标-1"><a href="#实现目标-1" class="headerlink" title="实现目标"></a>实现目标</h2><ul>
<li>增加 blast 功能：将用户提交的序列与 lncRNA 的序列库进行 blast 比对</li>
<li>创建 lncRNA 表达数据库，除了 part1 中提供的基础检索功能外，还要提供绘图功能</li>
<li>增加数据库的删除、追加（单条记录追加和批量追加）与编辑功能</li>
</ul>
<h2 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h2><p><strong>1. 增加 blast 功能</strong></p>
<p>目标序列的指定方式：</p>
<ul>
<li>用户在输入框中输入</li>
<li>用户提交目标序列的 fasta 文件</li>
</ul>
<p>创建lncRNA的 blast 序列库（即lncRNA的 blast 索引)：</p>
<ul>
<li>根据 part1 <a href="#prepare-data">《准备需要写入数据库中的数据》</a> 中得到的文件<code>lincRNA_GRCm38.91.gtf.format</code>和<code>lincRNA_GRCh38.91.gtf.format</code>，从中提取unique的lincRNA的Ensembl gene id</li>
<li>利用lincRNA的Ensembl gene id，从Ensembl的BioMart中下载lincRNA对应的序列</li>
<li>对这些序列建立blast索引</li>
</ul>
<p><strong>2. 创建 lncRNA 表达数据库</strong></p>
<p>从公共数据库（如GEO）中直接下载RNA-seq表达谱文件，或者下载原始fastq文件，自己跑RNA-seq分析流程来获取表达谱，然后提取其中的lincRNA部分，进行差异表达分析后将差异表达结果写进MySQL数据库中，同时保留表达谱文件，以供后期绘图时访问</p>
<ul>
<li><p>表达数据来源：从GEO数据库中下载某个RNA-seq实验的表达谱文件</p>
</li>
<li><p>差异表达分析：使用DESeq2进行差异表达分析，DESeq2使用方法请点 <a href="https://github.com/Ming-Lian/NGS-analysis/blob/master/RNA-seq.md#deseq2" target="_blank" rel="noopener">这里</a></p>
</li>
<li><p>将差异表达结果写进MySQL数据库中：过程与 part1 <a href="#use-mysqli">《将数据写入数据库中——方法一：使用MySQLi》</a>一样</p>
</li>
<li><p>绘图：即在检索获得差异表达结果列表后，每条记录后提供一个绘图按钮，用户点击后即可绘制出该基因在不同samples的表达柱状图，可通过调用R脚本实现</p>
</li>
</ul>
<p><strong>3. 增加数据库的删除、追加与编辑功能</strong></p>
<p>这部分应该是整个part2中最容易实现的部分</p>
<ul>
<li><p>删除 —— <strong>注意：在真正删除之前，请要求用户进行再次确认</strong></p>
<ul>
<li>删除一条记录：用SQL的DELETE语句</li>
<li>删除多条记录：在每条记录前有一个复选框，选中多条记录前的复选框，然后点击页面某个角落的“Delete”按钮，提交删除操作请求</li>
</ul>
</li>
<li><p>追加</p>
<ul>
<li>追加一条记录</li>
<li>批量追加：可以让用户提交文件来实现批量追加，不过真正进行追加操作之前，务必进行文件格式的检查</li>
</ul>
</li>
<li><p>编辑 —— 用UPDATE语句</p>
</li>
</ul>
<h2 id="添加blast功能"><a href="#添加blast功能" class="headerlink" title="添加blast功能"></a>添加blast功能</h2><h3 id="获得chrX上lincRNA序列"><a href="#获得chrX上lincRNA序列" class="headerlink" title="获得chrX上lincRNA序列"></a>获得chrX上lincRNA序列</h3><ul>
<li>利用Gene stable ID批量下载序列</li>
</ul>
<p>第一次写作业时，在mysql数据库中添加了lncRNA的位置信息、ID等。这次从之前建立数据得到的<code>lincRNA_GRCh38.91.gtf.format</code>和<code>lincRNA_GRCm38.91.gtf.format</code>文件中提取<code>Gene stable ID</code>，批量下载FASTA格式的序列信息。</p>
<ul>
<li>得到lnRNA的ID</li>
</ul>
<p>先以<code>lincRNA_GRCh38.91.gtf.format</code>（人类）为例</p>
<p>1. 通过<code>less lincRNA_GRCh38.91.gtf.format</code>查看文件</p>
<p>实例如下，第6列的就是基因ID（ENSG00000243485开始）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1       lincRNA gene    29554   31109   ENSG00000243485 MIR1302-2HG     -       -</span><br><span class="line">1       lincRNA transcript      29554   31097   ENSG00000243485 MIR1302-2HG     ENST00000473358 -</span><br><span class="line">1       lincRNA exon    29554   30039   ENSG00000243485 MIR1302-2HG     ENST00000473358 1</span><br><span class="line">1       lincRNA exon    30564   30667   ENSG00000243485 MIR1302-2HG     ENST00000473358 2</span><br><span class="line">1       lincRNA exon    30976   31097   ENSG00000243485 MIR1302-2HG     ENST00000473358 3</span><br><span class="line">1       lincRNA transcript      30267   31109   ENSG00000243485 MIR1302-2HG     ENST00000469289 -</span><br><span class="line">1       lincRNA exon    30267   30667   ENSG00000243485 MIR1302-2HG     ENST00000469289 1</span><br><span class="line">1       lincRNA exon    30976   31109   ENSG00000243485 MIR1302-2HG     ENST00000469289 2</span><br><span class="line">1       lincRNA gene    34554   36081   ENSG00000237613 FAM138A -       -</span><br><span class="line">1       lincRNA transcript      34554   36081   ENSG00000237613 FAM138A ENST00000417324 -</span><br><span class="line">1       lincRNA exon    35721   36081   ENSG00000237613 FAM138A ENST00000417324 1</span><br><span class="line">1       lincRNA exon    35277   35481   ENSG00000237613 FAM138A ENST00000417324 2</span><br><span class="line">1       lincRNA exon    34554   35174   ENSG00000237613 FAM138A ENST00000417324 3</span><br><span class="line">1       lincRNA transcript      35245   36073   ENSG00000237613 FAM138A ENST00000461467 -</span><br><span class="line">1       lincRNA exon    35721   36073   ENSG00000237613 FAM138A ENST00000461467 1</span><br><span class="line">1       lincRNA exon    35245   35481   ENSG00000237613 FAM138A ENST00000461467 2</span><br><span class="line">1       lincRNA gene    89295   133723  ENSG00000238009 AL627309.1      -       -</span><br><span class="line">1       lincRNA transcript      89295   120932  ENSG00000238009 AL627309.1      ENST00000466430 -</span><br><span class="line">1       lincRNA exon    120775  120932  ENSG00000238009 AL627309.1      ENST00000466430 1</span><br><span class="line">1       lincRNA exon    112700  112804  ENSG00000238009 AL627309.1      ENST00000466430 2</span><br><span class="line">1       lincRNA exon    92091   92240   ENSG00000238009 AL627309.1      ENST00000466430 3</span><br><span class="line">1       lincRNA exon    89295   91629   ENSG00000238009 AL627309.1      ENST00000466430 4</span><br></pre></td></tr></table></figure>
<p>2. 用<code>cut -f 6  lincRNA_GRCh38.91.gtf.format|sort|uniq &gt; lincRNA_GRCh38.91.geneid.txt</code>命令截取第6列ID信息，并输出到out文件中</p>
<p>3. 打开ensembl的<a href="http://asia.ensembl.org/biomart/martview/274417045864fe1b2b7636ae8c6c67d8" target="_blank" rel="noopener">biomart</a>，按照图片调整参数，最后上传ID信息文件即可。</p>
<p><strong>（由于全基因组数据太大，所以我在REGION中只选择了x染色体）</strong></p>
<p><img src="/images/InAction-PHP-MySQL-part2-getdata-from-BioMart-1.png" alt></p>
<p><img src="/images/InAction-PHP-MySQL-part2-getdata-from-BioMart-2.png" alt></p>
<p><img src="/images/InAction-PHP-MySQL-part2-getdata-from-BioMart-3.png" alt></p>
<p><img src="/images/InAction-PHP-MySQL-part2-getdata-from-BioMart-4.png" alt></p>
<p>4. 点击<code>results</code>,跳转页面点GO生成FASTA序列。</p>
<p>5. 小鼠数据如法炮制，只是在第一张照片处把Human参数改成Mouse。</p>
<h3 id="构建BLAST索引"><a href="#构建BLAST索引" class="headerlink" title="构建BLAST索引"></a>构建BLAST索引</h3><ul>
<li>删除课堂教学用的数据</li>
</ul>
<p>每人配额只有2G，所以清空一下磁盘，方便做作业</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#查看文件大小</span><br><span class="line">du -h</span><br><span class="line">#删除文件夹</span><br><span class="line">rm -rf filename</span><br><span class="line">-r ：循环删掉文件夹中的文件</span><br><span class="line">-f ：删除文件时不提示</span><br></pre></td></tr></table></figure>
<ul>
<li>构建BLAST索引</li>
</ul>
<p>在biomart下载完FASTA格式序列后，会得到<code>mart_export.txt</code>文件，修改文件名为<code>lincRNA_chrX.fa</code>将其导入服务器。</p>
<p>调用BLAST命令构建索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">makeblastdb -in /Path/To/lincRNA_chrX.fa -input_type fasta -dbtype nucl -title lncRNA_h -parse_seqids -out /Path/To/lncRNA_h -logfile File_h</span><br></pre></td></tr></table></figure>
<p>参数介绍</p>
<ul>
<li>-in:FASTA文件位置</li>
<li>-input_type:输入格式</li>
<li>-dbtype:数据库格式</li>
<li>-title:索引名称</li>
<li>-parse_seqids:不知道啥意思</li>
<li>-out:输出文件名（title感觉没啥用，最后blast调用索引都是调用输出文件）</li>
<li>-logfile:软件日志</li>
</ul>
<p>命令完成，打开软件日志File_h查看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Building a new DB, current time: 05/26/2018 15:17:13</span><br><span class="line">New DB name:   /home/201728016715029/blastdb/lncRNA_h</span><br><span class="line">New DB title:  lncRNA_h</span><br><span class="line">Sequence type: Nucleotide</span><br><span class="line">Keep MBits: T</span><br><span class="line">Maximum file size: 1000000000B</span><br><span class="line">Adding sequences from FASTA; added 246 sequences in 0.00809789 seconds.</span><br></pre></td></tr></table></figure>
<p>成功！</p>
<h3 id="执行BLAST"><a href="#执行BLAST" class="headerlink" title="执行BLAST"></a>执行BLAST</h3><ul>
<li>提交BLAST检索申请，脚本保存为<code>blastQuery.php</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;localblast.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">&lt;p&gt;输入你的序列&lt;/p&gt;</span><br><span class="line">&lt;textarea style=&quot;width:500px;height:200px;&quot; name=&quot;seq&quot;&gt;&gt;ENSG00000226530|ENST00000418775</span><br><span class="line">CACGCTCCTCCAGGGCGCAGAGAGCATCAAAGCATTATCACCGACCCAACACACACCGGC</span><br><span class="line">GCTGCGTAGTTTCTGCAGCAGGTGTGGGGTGAAGAGTTGCCACACAGCTGTCTGACACCG</span><br><span class="line">GGTGTACGGCGTCACCCCTCACTTCCTGGACAAGGCAACATTTTCCTAAAGGTCAAAGGA</span><br><span class="line">GAAAAATCCTATCATCTGAGGTGCTGAACAAAGAATTCAATAAATTCAATCAATCTGATG</span><br><span class="line">CACTCTGCAGTCGTTCTAAGTTCTTGTCTACTAAAATCCTCGACTACTACACATCCACAA</span><br><span class="line">TCGCTTCTGTGAAACTCTTGGGACCAAATGGTTCAGAATTTGTCTCCCATACATACATAA</span><br><span class="line">TATCTATGTCAAGGCCTGTAGTAATACTGTGGAATCTAATACAATGATATTTCTGTAGTG</span><br><span class="line">AAACATACAAATGTTCACTCCAAGATCTAAAGATTACAAATAGCATCATGTCAGTTCAAA</span><br><span class="line">TCAGGTTTTATGGATAAATGAGTCAGGAAAAGTATGTTTTTCAAAGCATTTTGAATGTTA</span><br><span class="line">GACTTGTGCACAAGGGATTGTGAGTCTGAATCATATTTCCGTCAAC&lt;/textarea&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;提交你的序列文件&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;</span><br><span class="line">		&lt;label for=&quot;file&quot;&gt;文件名：&lt;/label&gt;</span><br><span class="line">		&lt;input type=&quot;file&quot; style=&quot;width:800px;&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;</span><br><span class="line">	&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;&lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;!-- 提示信息 --&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td style=&quot;color:red;font-size:10px;&quot;&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$err=isset($_GET[&quot;err&quot;])?$_GET[&quot;err&quot;]:&quot;&quot;;</span><br><span class="line">switch($err) &#123;</span><br><span class="line">	case 1:</span><br><span class="line">		echo &quot;请在输入序列或提交序列文件！&quot;;</span><br><span class="line">		break;</span><br><span class="line">	case 2:</span><br><span class="line">		echo &quot;无法提交输入序列！&quot;;</span><br><span class="line">		break;</span><br><span class="line">	case 3:</span><br><span class="line">		echo &quot;未登陆，无权操作！请&lt;a href=\&quot;login.php\&quot;&gt;登陆&lt;/a&gt;&quot;;</span><br><span class="line">		break;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">	&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>执行BLAST操作，保存为<code>localhost.php</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//开启session</span><br><span class="line">session_start();</span><br><span class="line">// 获取用户名和密码</span><br><span class="line">$username=isset($_SESSION[&apos;user&apos;])?$_SESSION[&apos;user&apos;]:&quot;&quot;;</span><br><span class="line">$password=isset($_SESSION[&apos;password&apos;])?$_SESSION[&apos;password&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">// 通过POST方法获取表单提交信息</span><br><span class="line">$seq=isset($_POST[&apos;seq&apos;])?$_POST[&apos;seq&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">// 若既未输入序列也未提交序列文件，则返回BLAST申请界面，并显示错误信息</span><br><span class="line">if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0 &amp;&amp; empty($seq))&#123;</span><br><span class="line">	header(&quot;Location:blastQuery.php?err=1&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 若输入了序列，则将序列写入upload文件夹下的文本中</span><br><span class="line">$seqfile=&quot;upload/query.fa&quot;;</span><br><span class="line">if(!empty($seq))&#123;</span><br><span class="line">	if(!($file=fopen($seqfile, &quot;w&quot;)))&#123;</span><br><span class="line">        header(&quot;Location:blastQuery.php?err=2&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	fwrite($file,$seq);</span><br><span class="line">	fclose($file);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(!empty($username)&amp;&amp;!empty($password))&#123;</span><br><span class="line">	// 连接数据库</span><br><span class="line">	$conn=new mysqli(&apos;localhost&apos;,$username,$password,&apos;testdb&apos;);</span><br><span class="line">	if($conn-&gt;connect_error)&#123;</span><br><span class="line">		header(&quot;Location:blastQuery.php?err=3&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 执行BLAST，优先用输入序列进行BLAST</span><br><span class="line">	if(!empty($seq))&#123;</span><br><span class="line">		system(&apos;/home/Ben/software/blast/ncbi-blast-2.6.0+/bin/blastn -query upload/query.fa -db blastdb/lncRNA_h -html -evalue 1  -num_descriptions 10 -num_alignments 10 -out blast.out&apos;);</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		system(&apos;/home/Ben/software/blast/ncbi-blast-2.6.0+/bin/blastn -query upload/&apos;.$_FILES[&quot;file&quot;][&quot;name&quot;].&apos;  -db blastdb/lncRNA_h -html -evalue 1  -num_descriptions 10 -num_alignments 10 -out blast.out&apos;);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 打印BLAST结果</span><br><span class="line">	$file_out=fopen(&quot;blast.out&quot;,&quot;r&quot;) or exit(&quot;Unable to open file!&quot;);</span><br><span class="line">	while(!feof($file_out))&#123;</span><br><span class="line">		echo fgets($file_out);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	header(&quot;Location:blastQuery.php?err=3&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h2 id="添加lincRNA表达谱"><a href="#添加lincRNA表达谱" class="headerlink" title="添加lincRNA表达谱"></a>添加lincRNA表达谱</h2><h3 id="获取在两个样本组的表达谱"><a href="#获取在两个样本组的表达谱" class="headerlink" title="获取在两个样本组的表达谱"></a>获取在两个样本组的表达谱</h3><h4 id="数据集简单介绍与下载"><a href="#数据集简单介绍与下载" class="headerlink" title="数据集简单介绍与下载"></a>数据集简单介绍与下载</h4><p>该笔记中使用的数据集为 <a href="#nat-pro">Nature Protocols 文章</a>中用到的数据集</p>
<table>
<thead>
<tr>
<th style="text-align:left">sample id</th>
<th style="text-align:left">Sex</th>
<th style="text-align:left">population</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ERR188245</td>
<td style="text-align:left">Female</td>
<td style="text-align:left">GBR</td>
</tr>
<tr>
<td style="text-align:left">ERR188428</td>
<td style="text-align:left">Female</td>
<td style="text-align:left">GBR</td>
</tr>
<tr>
<td style="text-align:left">ERR188337</td>
<td style="text-align:left">Female</td>
<td style="text-align:left">GBR</td>
</tr>
<tr>
<td style="text-align:left">ERR188401</td>
<td style="text-align:left">Male</td>
<td style="text-align:left">GBR</td>
</tr>
<tr>
<td style="text-align:left">ERR188257</td>
<td style="text-align:left">Male</td>
<td style="text-align:left">GBR</td>
</tr>
<tr>
<td style="text-align:left">ERR188383</td>
<td style="text-align:left">Male</td>
<td style="text-align:left">GBR</td>
</tr>
<tr>
<td style="text-align:left">ERR204916</td>
<td style="text-align:left">Female</td>
<td style="text-align:left">YRI</td>
</tr>
<tr>
<td style="text-align:left">ERR188234</td>
<td style="text-align:left">Female</td>
<td style="text-align:left">YRI</td>
</tr>
<tr>
<td style="text-align:left">ERR188273</td>
<td style="text-align:left">Female</td>
<td style="text-align:left">YRI</td>
</tr>
<tr>
<td style="text-align:left">ERR188454</td>
<td style="text-align:left">Male</td>
<td style="text-align:left">YRI</td>
</tr>
<tr>
<td style="text-align:left">ERR188104</td>
<td style="text-align:left">Male</td>
<td style="text-align:left">YRI</td>
</tr>
<tr>
<td style="text-align:left">ERR188044</td>
<td style="text-align:left">Male</td>
<td style="text-align:left">YRI</td>
</tr>
</tbody>
</table>
<p>文章作者已经将数据集打包好了，下载链接：<code>ftp://ftp.ccb.jhu.edu/pub/RNAseq_protocol/chrX_data.tar.gz</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 下载</span><br><span class="line">$ nohup wget -c ftp://ftp.ccb.jhu.edu/pub/RNAseq_protocol/chrX_data.tar.gz &gt;download.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"># 解压</span><br><span class="line">$ tar zxvf chrX_data.tar.gz</span><br></pre></td></tr></table></figure>
<p>解压后可以看到数据集的组成<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">|---chrX_data</span><br><span class="line">	|---genes</span><br><span class="line">		|---chrX.gtf</span><br><span class="line">	|---genome</span><br><span class="line">		|---chrX.fa</span><br><span class="line">	|---indexes</span><br><span class="line">		|---chrX_tran.[1-7].ht2</span><br><span class="line">	|---samples</span><br><span class="line">		|---ERR*_chrX_[12].fastq.gz</span><br></pre></td></tr></table></figure></p>
<h4 id="跑RNA-seq分析流程"><a href="#跑RNA-seq分析流程" class="headerlink" title="跑RNA-seq分析流程"></a>跑RNA-seq分析流程</h4><p>RNA-seq分析流程，请参考 <a href="https://github.com/Ming-Lian/NGS-analysis/blob/master/RNA-seq.md" target="_blank" rel="noopener">这里</a></p>
<p>一般第一步是创建hisat2索引，由于数据集中已经提供了（在<code>chrX_data/indexes</code>文件夹下），所以跳过这一步</p>
<ul>
<li><strong>hisat2比对</strong></li>
</ul>
<p>在比对前，先准备好一个保存样本Id的文本<code>samplelist.txt</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ERR188245</span><br><span class="line">ERR188428</span><br><span class="line">ERR188337</span><br><span class="line">ERR188401</span><br><span class="line">ERR188257</span><br><span class="line">ERR188383</span><br><span class="line">ERR204916</span><br><span class="line">ERR188234</span><br><span class="line">ERR188273</span><br><span class="line">ERR188454</span><br><span class="line">ERR188104</span><br><span class="line">ERR188044</span><br></pre></td></tr></table></figure>
<p>开始执行批量比对</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir map</span><br><span class="line"></span><br><span class="line">$ nohup cat samplelist.txt | while read i;</span><br><span class="line">do</span><br><span class="line">	hisat2 -p 10 --dta -x indexes/chrX_tran -1 samples/$&#123;i&#125;_chrX_1.fastq.gz -2 samples/$&#123;i&#125;_chrX_2.fastq.gz | \</span><br><span class="line">	samtools sort -@ 8 -O bam -o map/$&#123;i&#125;_chrX.sort.bam 1&gt;map/$&#123;i&#125;_map.log 2&gt;&amp;1</span><br><span class="line">done &amp;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>stringtie转录本拼接</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir asm</span><br><span class="line"></span><br><span class="line"># 拼接</span><br><span class="line">$ cat cat samplelist.txt | while read i;</span><br><span class="line">do</span><br><span class="line">	stringtie -p 16 -G genes/chrX.gtf -o asm/$&#123;i&#125;_chrX.gtf -l $i map/$&#123;i&#125;_chrX.sort.bam 1&gt;asm/$&#123;i&#125;_strg_assm.log 2&gt;&amp;1</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"># 准备mergelist.txt文件</span><br><span class="line">$ awk &apos;&#123;print &quot;asm/&quot;$0&quot;_chrX.gtf&quot;&#125;&apos; samplelist.txt &gt;mergelist.txt</span><br><span class="line"></span><br><span class="line"># merge多样本的转录本拼接结果</span><br><span class="line">$ stringtie --merge -p 16 -G genes/chrX.gtf -o asm/merge.gtf mergelist.txt 1&gt;asm/strg_merge.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>stringtie定量</strong></li>
</ul>
<p>以read count进行定量，作为DESeq2或edgeR的输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir quant</span><br><span class="line"></span><br><span class="line"># 转录本定量</span><br><span class="line">$ cat samplelist.txt | while read i;</span><br><span class="line">do</span><br><span class="line">	stringtie -e -p 16 -G asm/merge.gtf -o quant/$&#123;i&#125;_chrX_quant.gtf map/$&#123;i&#125;_chrX.sort.bam 1&gt;quant/$&#123;i&#125;_chrX_quant.log 2&gt;&amp;1</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"># 整合多样本的转录本定量结果</span><br><span class="line">## 先准备sample_lst.txt文件，格式如下：</span><br><span class="line">		ERR188021 &lt;PATH_TO_ERR188021.gtf&gt;</span><br><span class="line">		ERR188023 &lt;PATH_TO_ERR188023.gtf&gt;</span><br><span class="line">		...</span><br><span class="line">$ perl -ne &apos;chomp;print &quot;$_\tquant/$&#123;_&#125;_chrX_quant.gtf\n&quot;&apos; samplelist.txt &gt;samplelist.quant.txt</span><br><span class="line"></span><br><span class="line">## 执行定量结果整合</span><br><span class="line">$ python2 /Path/To/prepDE.py -i sample_lst.txt</span><br></pre></td></tr></table></figure>
<p>最后会在工作目录下产生两个read count定量文件：</p>
<blockquote>
<ul>
<li>gene定量：gene_count_matrix.csv</li>
<li>transcript定量：transcript_count_matrix.csv</li>
</ul>
</blockquote>
<p>想下载这两个文件，请点 <a href="./txt-supply/">这里</a></p>
<ul>
<li><strong>差异表达分析：DESeq2</strong></li>
</ul>
<p>DESeq2要求输入的表达矩阵是read counts</p>
<p>构建 DESeqDataSet 对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 构建表达矩阵</span><br><span class="line">count_table&lt;-read.csv(&quot;gene_count_matrix.csv&quot;,row.names=&quot;gene_id&quot;)</span><br><span class="line">count_matrix&lt;-as.matrix(count_table)</span><br><span class="line"># 构建分组矩阵</span><br><span class="line">phenodata&lt;-read.csv(&quot;geuvadis_phenodata.csv&quot;,row.names=&quot;ids&quot;)</span><br><span class="line"># 构建 DESeqDataSet 对象</span><br><span class="line">dds &lt;- DESeqDataSetFromMatrix(countData = count_matrix,</span><br><span class="line">	colData = phenodata,</span><br><span class="line">	design = ~ population)</span><br></pre></td></tr></table></figure>
<p>差异表达分析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dds &lt;- DESeq(dds)</span><br><span class="line">res &lt;- results(dds)</span><br><span class="line">resOrdered &lt;- res[order(res$padj),]</span><br><span class="line">diffResult &lt;- as.data.frame(resOrdered)</span><br><span class="line">write.table(diffResult,&quot;gene_diffResult.txt&quot;,sep=&quot;\t&quot;,quote=F)</span><br></pre></td></tr></table></figure>
<p>这一步最终得到差异表达分析结果文件<code>gene_diffResult.txt</code>，想下载这两个文件，请点 <a href="./txt-supply/">这里</a></p>
<h3 id="将差异表达结果写进MySQL"><a href="#将差异表达结果写进MySQL" class="headerlink" title="将差异表达结果写进MySQL"></a>将差异表达结果写进MySQL</h3><p>过程与 part1 <a href="#use-mysqli">方法一：使用MySQLi</a> 相同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 创建表格DiffExp_result</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE TABLE DiffExp_result (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `RefSeq` varchar(255) NOT NULL DEFAULT &apos;&apos; COMMENT &apos;RefSeq id&apos;,</span><br><span class="line">  `baseMean` DOUBLE(40,20) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;the base mean over all rows&apos;,</span><br><span class="line">  `log2FoldChange` DOUBLE(40,20) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;log2 fold change (MAP): treatment OHT vs Control&apos;,</span><br><span class="line">  `lfcSE` DOUBLE(40,20) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;standard error: treatment OHT vs Control&apos;,</span><br><span class="line">  `stat` DOUBLE(40,20) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;Wald statistic: treatment OHT vs Control&apos;,</span><br><span class="line">  `pvalue` FLOAT(20) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;Wald test p-value: treatment OHT vs Control&apos;,</span><br><span class="line">  `padj` FLOAT(20) NOT NULL DEFAULT &apos;0&apos; COMMENT &apos;BH adjusted p-values&apos;,</span><br><span class="line">  PRIMARY KEY (`id`) </span><br><span class="line">) ;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:left">数据类型</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">TINYINT(size)</td>
<td style="text-align:left">-128 到 127 常规。0 到 255 无符号*。在括号中规定最大位数。</td>
</tr>
<tr>
<td style="text-align:left">SMALLINT(size)</td>
<td style="text-align:left">-32768 到 32767 常规。0 到 65535 无符号*。在括号中规定最大位数。</td>
</tr>
<tr>
<td style="text-align:left">MEDIUMINT(size)</td>
<td style="text-align:left">-8388608 到 8388607 普通。0 to 16777215 无符号*。在括号中规定最大位数。</td>
</tr>
<tr>
<td style="text-align:left">INT(size)</td>
<td style="text-align:left">-2147483648 到 2147483647 常规。0 到 4294967295 无符号*。在括号中规定最大位数。</td>
</tr>
<tr>
<td style="text-align:left">BIGINT(size)</td>
<td style="text-align:left">-9223372036854775808 到 9223372036854775807 常规。0 到 18446744073709551615 无符号*。在括号中规定最大位数。</td>
</tr>
<tr>
<td style="text-align:left">FLOAT(size,d)</td>
<td style="text-align:left">带有浮动小数点的小数字。在括号中规定最大位数。在 d 参数中规定小数点右侧的最大位数。</td>
</tr>
<tr>
<td style="text-align:left">DOUBLE(size,d)</td>
<td style="text-align:left">带有浮动小数点的大数字。在括号中规定最大位数。在 d 参数中规定小数点右侧的最大位数。</td>
</tr>
<tr>
<td style="text-align:left">DECIMAL(size,d)</td>
<td style="text-align:left">作为字符串存储的 DOUBLE 类型，允许固定的小数点。</td>
</tr>
</tbody>
</table>
<p>基于 part1 中的php脚本<code>data_batch_import.php</code>稍作修改即可复用</p>
<p>需要改动的位置如下图：</p>
<p><img src="/images/InAction-PHP-MySQL-part2-modify-phpscript-location.jpg" alt></p>
<p>直接手动修改PHP脚本，保存为<code>lincRNA_DiffExp_data_batch_import.php</code></p>
<p>以下只给出修改部分的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// 预处理及绑定</span><br><span class="line">$stmt=$conn-&gt;prepare(&quot;INSERT INTO DiffExp_result (RefSeq,baseMean,log2FoldChange,lfcSE,stat,pvalue,padj) VALUES (?,?,?,?,?,?,?)&quot;);</span><br><span class="line">$stmt-&gt;bind_param(&quot;sdddddd&quot;,$RefSeq,$baseMean,$log2FoldChange,$lfcSE,$stat,$pvalue,$padj);</span><br><span class="line"></span><br><span class="line">// 打开文件，通过$argv[1]进行脚本传参</span><br><span class="line">$file=fopen(&quot;$argv[1]&quot;,&apos;r&apos;) or exit(&quot;Unable to open file!&quot;);</span><br><span class="line"></span><br><span class="line">// 逐行读取文件，并写入数据库</span><br><span class="line">fgets($file);	// 跳过第一行表头</span><br><span class="line">while(!feof($file))&#123;</span><br><span class="line">	$data=explode(&quot;\t&quot;,fgets($file)); // 以tab为间隔标识将字符串打散</span><br><span class="line">	</span><br><span class="line">	// 设置参数</span><br><span class="line">	$RefSeq=$data[0];</span><br><span class="line">	$baseMean=$data[1];</span><br><span class="line">	$log2FoldChange=$data[2];</span><br><span class="line">	$lfcSE=$data[3];</span><br><span class="line">	$stat=$data[4];</span><br><span class="line">	$pvalue=$data[5];</span><br><span class="line">	$padj=$data[6];</span><br><span class="line">	// 执行</span><br><span class="line">	$stmt-&gt;execute();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后执行php脚本，完成数据的批量导入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php -f lincRNA_DiffExp_data_batch_import.php &lt;data-to-import&gt;</span><br></pre></td></tr></table></figure>
<h3 id="检索表达谱数据库"><a href="#检索表达谱数据库" class="headerlink" title="检索表达谱数据库"></a>检索表达谱数据库</h3><p>过程类似于 part1 <a href="#query">检索数据库</a></p>
<p>表单部分，提供以下检索筛选条件</p>
<blockquote>
<ul>
<li>log2FoldChange 一般认为其绝对值大于1，差异显著</li>
<li>p-value 一般认为其值小于等于0.05，差异显著</li>
<li>q-value 一般认为其值小于等于0.05，差异显著</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;#&quot; method=&quot;post&quot;&gt;</span><br><span class="line">&lt;table style=&quot;text-align:center; border:0;&quot;&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;|log2FoldChange| &gt;=&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;log2FoldChange&quot; value=&quot;1&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;p-value &lt;=&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;p_value&quot; value=&quot;0.05&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;q-value &lt;=&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;q_value&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td align=&quot;center&quot;&gt;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Submit&quot;&gt;&lt;/td&gt;</span><br><span class="line">	&lt;td align=&quot;center&quot;&gt;&lt;input type=&quot;reset&quot; value=&quot;Reset&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;!-- 错误提示信息 --&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td style=&quot;color:red; font-size:10px;&quot;&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$err=isset($_GET[&quot;err&quot;])?$_GET[&quot;err&quot;]:&quot;&quot;;</span><br><span class="line">switch($err) &#123;</span><br><span class="line">case 1:</span><br><span class="line">	echo &quot;表单填写错误：至少要填写一项！&quot;;</span><br><span class="line">	break;</span><br><span class="line">case 2:</span><br><span class="line">	echo &quot;表单填写错误：填写信息必须是数字！&quot;;</span><br><span class="line">	break;</span><br><span class="line">case 3:</span><br><span class="line">	echo &quot;未登陆，无权访问！&quot;;</span><br><span class="line">	echo &quot;快去&lt;a href=&apos;login.php&apos;&gt;登录&lt;/a&gt;吧！&quot;;</span><br><span class="line">	break;</span><br><span class="line">case 4:</span><br><span class="line">	echo &quot;Update或Delete操作异常！未在数据库中找到对应记录！&quot;;</span><br><span class="line">	break;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;	</span><br><span class="line">	&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<p>php脚本部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//开启session</span><br><span class="line">session_start();</span><br><span class="line">// 获取用户名和密码</span><br><span class="line">$username=isset($_SESSION[&apos;user&apos;])?$_SESSION[&apos;user&apos;]:&quot;&quot;;</span><br><span class="line">$password=isset($_SESSION[&apos;password&apos;])?$_SESSION[&apos;password&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">// 获取表单提交数据</span><br><span class="line">$log2FoldChange=isset($_POST[&apos;log2FoldChange&apos;])?$_POST[&apos;log2FoldChange&apos;]:&quot;&quot;;</span><br><span class="line">$p_value=isset($_POST[&apos;p_value&apos;])?$_POST[&apos;p_value&apos;]:&quot;&quot;;</span><br><span class="line">$q_value=isset($_POST[&apos;q_value&apos;])?$_POST[&apos;q_value&apos;]:&quot;&quot;;</span><br><span class="line">$submit=isset($_POST[&apos;submit&apos;])?$_POST[&apos;submit&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">if($submit)&#123;</span><br><span class="line">	// 判断提交的检索信息是否满足要求：三个提交的变量,至少一个不为空，且若不为空则必须是数值</span><br><span class="line">	if(empty($log2FoldChange)&amp;&amp;empty($p_value)&amp;&amp;empty($q_value))&#123;</span><br><span class="line">		header(&quot;Location:databaseQuery_DiffExp.php?err=1&quot;);	</span><br><span class="line">	&#125;elseif((empty($log2FoldChange)||is_numeric($log2FoldChange))&amp;&amp;(empty($p_value)||is_numeric($p_value))&amp;&amp;(empty($q_value)||is_numeric($q_value)))&#123;</span><br><span class="line">		// 连接数据库</span><br><span class="line">		$conn=new mysqli(&apos;localhost&apos;,$username,$password,&apos;testdb&apos;);</span><br><span class="line">		if($conn-&gt;connect_error)&#123;</span><br><span class="line">			header(&quot;Location:databaseQuery_DiffExp.php?err=3&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		// 创建SQL查询语句</span><br><span class="line">		$sql=&quot;SELECT * from DiffExp_result where&quot;;</span><br><span class="line">		// 根据实际表单填写情况追加查询条件</span><br><span class="line">		$bool_and=false;</span><br><span class="line">		if(!empty($log2FoldChange))&#123;</span><br><span class="line">			$sql .= &quot; log2FoldChange &gt;= $log2FoldChange or log2FoldChange &lt;= -$log2FoldChange&quot;;</span><br><span class="line">			$bool_and=true;</span><br><span class="line">		&#125;</span><br><span class="line">		if(!empty($p_value))&#123;</span><br><span class="line">			if($bool_and)&#123;</span><br><span class="line">				$sql .= &quot; and&quot;;</span><br><span class="line">			&#125;</span><br><span class="line">			$sql .= &quot; pvalue &lt;= $p_value&quot;;</span><br><span class="line">			$bool_and=true;</span><br><span class="line">		&#125;</span><br><span class="line">		if(!empty($q_value))&#123;</span><br><span class="line">			if($bool_and)&#123;</span><br><span class="line">				$sql .= &quot; and&quot;;</span><br><span class="line">			&#125;</span><br><span class="line">			$sql .= &quot; padj &lt;= $q_value&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">		$sql .= &quot;;&quot;;</span><br><span class="line">		</span><br><span class="line">		// 执行查询语句</span><br><span class="line">		$result=$conn-&gt;query($sql);</span><br><span class="line">		if($result-&gt;num_rows &gt; 0)&#123;</span><br><span class="line">			// 输出查询结果</span><br><span class="line">			echo &quot;&lt;table&gt;&lt;tr&gt;&lt;th&gt;RefSeq&lt;/th&gt;&lt;th&gt;baseMean&lt;/th&gt;&lt;th&gt;log2FoldChange&lt;/th&gt;&lt;th&gt;lfcSE&lt;/th&gt;&lt;th&gt;stat&lt;/th&gt;&lt;th&gt;pvalue&lt;/th&gt;&lt;th&gt;padj&lt;/th&gt;&lt;th&gt;操作&lt;/th&gt;&lt;/tr&gt;&quot;;</span><br><span class="line">			</span><br><span class="line">			while($row = $result-&gt;fetch_array())&#123;</span><br><span class="line">        			echo &quot;&lt;tr&gt;&lt;td&gt;&quot;.$row[&apos;RefSeq&apos;].&quot;&lt;/td&gt;&lt;td&gt;&quot;.$row[&apos;baseMean&apos;].&quot;&lt;/td&gt;&lt;td&gt;&quot;.$row[&apos;log2FoldChange&apos;].&quot;&lt;/td&gt;&lt;td&gt;&quot;.$row[&apos;lfcSE&apos;].&quot;&lt;/td&gt;&lt;td&gt;&quot;.$row[&apos;stat&apos;].&quot;&lt;/td&gt;&lt;td&gt;&quot;.$row[&apos;pvalue&apos;].&quot;&lt;/td&gt;&lt;td&gt;&quot;.$row[&apos;padj&apos;].&quot;&lt;/td&gt;&lt;td&gt;&lt;a href=\&quot;update_form.php?id=&quot;.$row[&apos;id&apos;].&quot;&amp;dbname=DiffExp_result\&quot; style=\&quot;padding:2px;\&quot;&gt;Update&lt;/a&gt;&lt;a href=\&quot;barplox.php?RefSeq=&quot;.$row[&apos;RefSeq&apos;].&quot;\&quot; style=\&quot;padding:2px;\&quot;&gt;Barplox&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;\n&quot;;</span><br><span class="line">    		&#125;</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">    			echo &quot;未检索到满足条件的记录!&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		header(&quot;Location:databaseQuery_DiffExp.php?err=2&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h3 id="画图：单个基因表达谱"><a href="#画图：单个基因表达谱" class="headerlink" title="画图：单个基因表达谱"></a>画图：单个基因表达谱</h3><p>实现思路：</p>
<blockquote>
<ul>
<li>用户在检索页面的记录栏的最后一项点击<code>Barplot</code>以后，向绘图脚本(<code>barplot.php</code>)传递对应记录的RefSeq</li>
<li><p>绘图脚本(<code>barplot.php</code>)根据传递过来的RefSeq，调用绘图用的底层R脚本(<code>barplot.R</code>)，调用的同时传递参数——RefSeq值</p>
<p> <code>barplot.R</code>实现的功能：读取表达谱文件（<a href="#run-rnaseq-pipeline">跑RNA-seq分析流程：stringtie定量</a> 产生的<code>gene_count_matrix.csv</code>文件），根据传递过来的RefSeq值匹配出对应的基因的表达谱，然后用ggplot把图画出来，并将图保存为图像文件</p>
</li>
<li>绘图脚本(<code>barplot.php</code>)将图片用<code>&lt;img&gt;</code>标签呈现给用户</li>
</ul>
</blockquote>
<ul>
<li>绘图脚本(<code>barplot.php</code>)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//开启session</span><br><span class="line">session_start();</span><br><span class="line">// 获取用户名和密码</span><br><span class="line">$username=isset($_SESSION[&apos;user&apos;])?$_SESSION[&apos;user&apos;]:&quot;&quot;;</span><br><span class="line">$password=isset($_SESSION[&apos;password&apos;])?$_SESSION[&apos;password&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">// 用GET方法获取提交的数据</span><br><span class="line">$RefSeq=isset($_GET[&apos;RefSeq&apos;])?$_GET[&apos;RefSeq&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">// 登录数据库，检查用户是否有操作权限</span><br><span class="line">$conn=new mysqli(&apos;localhost&apos;,$username,$password,&apos;testdb&apos;);</span><br><span class="line">if($conn-&gt;connect_error)&#123;</span><br><span class="line">	header(&quot;Location:databaseQuery_DiffExp.php?err=3&quot;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	system(&apos;Rscript barplot.R &apos;.$RefSeq);</span><br><span class="line">	// 检查文件是否存在</span><br><span class="line">	if(file_exists(&apos;barplot.jpg&apos;))&#123;</span><br><span class="line">		echo &quot;&lt;p align=\&quot;center\&quot;&gt;&lt;img src=./barplot.jpg width=600 &gt;&lt;/p&gt;&quot;;</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		echo &quot;&lt;p style=\&quot;color:red; text-align:center; font-size:50px;\&quot;&gt;绘图失败！&lt;/p&gt;&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>底层R脚本(<code>barplot.R</code>)</li>
</ul>
<p>注意：</p>
<blockquote>
<p>该脚本底层依赖<code>ggplot2</code>包，若未安装请提前安装好，推荐以下两种安装方法：</p>
<ul>
<li>直接在R的交互环境下，使用<code>install.packages(&quot;ggplot2&quot;)</code></li>
<li>使用conda进行安装</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">library(ggplot2)</span><br><span class="line"># 获取传入参数</span><br><span class="line">args&lt;-commandArgs(T)</span><br><span class="line"># 载入全表达谱</span><br><span class="line">profile &lt;- read.csv(&quot;gene_count_matrix.csv&quot;)</span><br><span class="line">profile_matrix &lt;- as.matrix(profile[,-1])</span><br><span class="line">rownames(profile_matrix)&lt;-profile$gene_id</span><br><span class="line"># 获取目标基因的表达谱</span><br><span class="line">geneExp &lt;- data.frame(Sample=colnames(profile_matrix),Expression=profile_matrix[args[1],])</span><br><span class="line">#画图并导出</span><br><span class="line">jpeg(&quot;barplot.jpg&quot;)</span><br><span class="line">ggplot(geneExp)+geom_bar(aes(x=sample,y=expression),stat=&quot;identity&quot;)+theme(axis.text.x = element_text(angle = 60, hjust = 0.5, vjust = 0.5))</span><br><span class="line">dev.off()</span><br></pre></td></tr></table></figure>
<h2 id="添加批量提交数据功能"><a href="#添加批量提交数据功能" class="headerlink" title="添加批量提交数据功能"></a>添加批量提交数据功能</h2><p>基本的实现思路为：</p>
<blockquote>
<p>提供文件提交的输入框，同时让用户指定向哪个数据库（实际上是不同的表格）提交数据。将用户提交的文件保存为服务器某个目录下的临时文件，然后用 </p>
<ul>
<li>part1 <a href="#use-mysqli">将数据写入数据库中：方法一：使用MySQLi</a>的脚本<code>lincRNA_Ano_data_batch_import.php</code></li>
<li>或者，part2 <a href="#write-profile-data">将差异表达结果写进MySQL</a>的脚本<code>lincRNA_DiffExp_data_batch_import.php</code></li>
</ul>
<p>将临时文件的数据追加导入相应的表格中</p>
</blockquote>
<p>预备知识：</p>
<blockquote>
<ul>
<li>文件上传，请点 <a href="https://github.com/Ming-Lian/Memo/blob/master/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9APHP%E4%B8%80%E5%91%A8%E9%80%9F%E6%88%90.md#upload-file" target="_blank" rel="noopener">这里</a></li>
</ul>
</blockquote>
<p>要实现文件上传，首先要在php脚本所在的文件夹下创建一个权限全开的<code>upload</code>文件夹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir upload</span><br><span class="line">$ chmod 777 upload</span><br></pre></td></tr></table></figure>
<p>接着开始编辑php脚本，保存为<code>batch_submit_data.php</code></p>
<p>表单部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;batch_submit_data.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;选择提交数据库：&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;</span><br><span class="line">		&lt;select name=&quot;dbname&quot;&gt;</span><br><span class="line">			&lt;option value=&quot;&quot;&gt;选择数据库:&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;ano&quot;&gt;基因结构注释&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;diffexp&quot;&gt;基因表达谱&lt;/option&gt;</span><br><span class="line">		&lt;/select&gt;</span><br><span class="line">	&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;选择物种（基因结构注释）：&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;</span><br><span class="line">		&lt;select name=&quot;specie&quot;&gt;</span><br><span class="line">			&lt;option value=&quot;&quot;&gt;选择一个物种:&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;human&quot;&gt;Homo Sapiens&lt;/option&gt;</span><br><span class="line">			&lt;option value=&quot;mouse&quot;&gt;Mus musculus&lt;/option&gt;</span><br><span class="line">		&lt;/select&gt;</span><br><span class="line">	&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td&gt;选择上传数据文件：&lt;/td&gt;</span><br><span class="line">	&lt;td&gt;</span><br><span class="line">    	&lt;label for=&quot;file&quot;&gt;文件名：&lt;/label&gt;</span><br><span class="line">    	&lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br&gt;</span><br><span class="line">    &lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td align=&quot;center&quot;&gt;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;提交&quot;&gt;&lt;/td&gt;</span><br><span class="line">	&lt;td align=&quot;center&quot;&gt;&lt;input type=&quot;reset&quot; value=&quot;Reset&quot;&gt;&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;!-- 报错信息 --&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">	&lt;td style=&quot;color:red; font-size:10px;&quot;&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$err=isset($_GET[&quot;err&quot;])?$_GET[&quot;err&quot;]:&quot;&quot;;</span><br><span class="line">switch($err) &#123;</span><br><span class="line">case 1:</span><br><span class="line">	echo &quot;表单填写错误：必须选择一个数据库！&quot;;</span><br><span class="line">	break;</span><br><span class="line">case 2:</span><br><span class="line">	echo &quot;上传文件格式不符合要求！请参照&lt;a href=\&quot;formatGuid.html\&quot;&gt;格式要求&lt;/a&gt;进行修改！&quot;;</span><br><span class="line">	break;</span><br><span class="line">case 3:</span><br><span class="line">	echo &quot;未登陆，无权访问！&quot;;</span><br><span class="line">	echo &quot;快去&lt;a href=&apos;login.php&apos;&gt;登录&lt;/a&gt;吧！&quot;;</span><br><span class="line">	break;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<p>php脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//开启session</span><br><span class="line">session_start();</span><br><span class="line">// 获取用户名和密码</span><br><span class="line">$username=isset($_SESSION[&apos;user&apos;])?$_SESSION[&apos;user&apos;]:&quot;&quot;;</span><br><span class="line">$password=isset($_SESSION[&apos;password&apos;])?$_SESSION[&apos;password&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">// 创建Ano_check函数，进行上传文本的文件格式检查</span><br><span class="line">function Ano_check($fname)</span><br><span class="line">&#123;</span><br><span class="line">	$file=fopen(&quot;upload/$fname&quot;,&quot;r&quot;) or exit(&quot;Unable to open file!&quot;);</span><br><span class="line">	$bool_mark=1;</span><br><span class="line">	while(!feof($file))&#123;</span><br><span class="line">		$data=explode(&quot;\t&quot;,fgets($file));</span><br><span class="line">		// 检查第一列，是否为1-22或XY</span><br><span class="line">		if(!preg_match(&quot;\d&#123;1,2&#125;|[XY]&quot;,$data[0]))&#123;</span><br><span class="line">			$bool_mark=0;</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">		// 检查第二三列，是否都是英文字母</span><br><span class="line">		if(!preg_match(&quot;[a-zA-Z]&quot;,$data[1])||!preg_match(&quot;[a-zA-Z]&quot;,$data[2]))&#123;</span><br><span class="line">			$bool_mark=0;</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">		// 检查第四五列，即start和end，是否是数字</span><br><span class="line">		if(!is_numeric($data[3])||!is_numeric($data[4]))&#123;</span><br><span class="line">			$bool_mark=0;</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">		// 检查第六八列，即GeneId和TranscriptId,是否以ENSG或ENSG打头</span><br><span class="line">		if(!preg_match(&quot;^ENSG&quot;,$data[5])||!preg_match(&quot;^(ENST)|-&quot;,$data[5]))&#123;</span><br><span class="line">			$bool_mark=0;</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return $bool_mark;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 创建DiffExp_check函数，进行上传文本的文件格式检查</span><br><span class="line">function DiffExp_check($fname)</span><br><span class="line">&#123;</span><br><span class="line">	$file=fopen(&quot;upload/$fname&quot;,&quot;r&quot;) or exit(&quot;Unable to open file!&quot;);</span><br><span class="line">	$bool_mark=1;</span><br><span class="line">	while(!feof($file))&#123;</span><br><span class="line">		$data=explode(&quot;\t&quot;,fgets($file));</span><br><span class="line">		// 检查第一列，RefSeq，是否以大写字母打头</span><br><span class="line">		if(!preg_match(&quot;^[A-Z]&#123;2,&#125;&quot;,$data[0]))&#123;</span><br><span class="line">			$bool_mark=0;</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">		// 检查其他列，是否都是数字</span><br><span class="line">		if(!is_numeric($data[1])||!is_numeric($data[2])||!is_numeric($data[3])||!is_numeric($data[4])||!is_numeric($data[5])||!is_numeric($data[6]))&#123;</span><br><span class="line">			$bool_mark=0;</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return $bool_mark;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 获取表单提交数据</span><br><span class="line">$dbname=isset($_POST[&apos;dbname&apos;])?$_POST[&apos;dbname&apos;]:&quot;&quot;;</span><br><span class="line">$specie=isset($_POST[&apos;specie&apos;])?$_POST[&apos;specie&apos;]:&quot;&quot;;</span><br><span class="line">$submit=isset($_POST[&apos;submit&apos;])?$_POST[&apos;submit&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">if($submit)&#123;</span><br><span class="line">	// 检查文件上传是否成功</span><br><span class="line">	if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)</span><br><span class="line">	&#123;</span><br><span class="line">    	echo &quot;错误：&quot; . $_FILES[&quot;file&quot;][&quot;error&quot;] . &quot;&lt;br&gt;&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 进行文件格式检查</span><br><span class="line">	if(empty($dbname))&#123;</span><br><span class="line">		header(&quot;Location:batch_submit_data.php?err=1&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	elseif($dbname==&quot;ano&quot;)&#123;</span><br><span class="line">		$check_stat=Ano_check($_FILE[&apos;file&apos;][&apos;name&apos;]);</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		$check_stat=DiffExp_check($_FILE[&apos;file&apos;][&apos;name&apos;]);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 判断文件格式是否符合要求</span><br><span class="line">	if(!$check_stat)&#123;</span><br><span class="line">		header(&quot;Location:batch_submit_data.php?err=2&quot;);</span><br><span class="line">	// 判断用户名和密码是否已经设置</span><br><span class="line">	&#125;elseif(!empty($username)&amp;&amp;!empty($password))&#123;</span><br><span class="line">		// 连接数据库</span><br><span class="line">		$conn=new mysqli(&apos;localhost&apos;,$username,$password,&apos;testdb&apos;);</span><br><span class="line">		if($conn-&gt;connect_error)&#123;</span><br><span class="line">			header(&quot;batch_submit_data.php?err=3&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		// 设置数据库表格名，并执行批量操作</span><br><span class="line">		if($dbname==&quot;ano&quot;)&#123;</span><br><span class="line">			if($specie==&quot;human&quot;)&#123;</span><br><span class="line">				$table=&quot;lincRNA_h&quot;;</span><br><span class="line">			&#125;else&#123;</span><br><span class="line">				$table=&quot;lincRNA_m&quot;;</span><br><span class="line">			&#125;</span><br><span class="line">			system(&quot;php -f lincRNA_Ano_data_batch_import.php &quot;.$table.&quot; upload/&quot;.$_FILE[&apos;file&apos;][&apos;name&apos;].&quot; &amp;&quot;);</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">			system(&quot;php -f lincRNA_DiffExp_data_batch_import.php upload/&quot;.$_FILE[&apos;file&apos;][&apos;name&apos;].&quot; &amp;&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		// 调用之前的php脚本进行批量提交操作		</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		header(&quot;Location:batch_submit_data.php?err=3&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h2 id="添加Update功能"><a href="#添加Update功能" class="headerlink" title="添加Update功能"></a>添加Update功能</h2><p>实现思路：</p>
<blockquote>
<ul>
<li>用户在检索页面的记录栏的最后一项点击<code>update</code>以后，跳转到update表单填写页面(<code>update_form.php</code>脚本)，同时向该php脚本传递对应记录的id</li>
<li>update表单填写页面(<code>update_form.php</code>脚本)根据传递过来的id，把对应记录的信息以表单形式呈现，同时表单的每个输入框可以收集用户的修改信息</li>
<li>用户修改后点击”submit”，执行update操作(<code>updata_operate_Ano.php</code>或<code>updata_operate_DiffExp.php</code>脚本)，同时将操作状态告知用户：是不是成功了？</li>
</ul>
</blockquote>
<ul>
<li>脚本<code>update_form.php</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//开启session</span><br><span class="line">session_start();</span><br><span class="line">// 获取用户名和密码</span><br><span class="line">$username=isset($_SESSION[&apos;user&apos;])?$_SESSION[&apos;user&apos;]:&quot;&quot;;</span><br><span class="line">$password=isset($_SESSION[&apos;password&apos;])?$_SESSION[&apos;password&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">// 获取通过GET方法向该脚本传递的变量</span><br><span class="line">$id=isset($_GET[&apos;id&apos;])?$_GET[&apos;id&apos;]:&quot;&quot;;</span><br><span class="line">$dbname=isset($_GET[&apos;dbname&apos;])?$_GET[&apos;dbname&apos;]:&quot;&quot;;</span><br><span class="line">$statu=isset($_GET[&apos;statu&apos;])?$_GET[&apos;statu&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">// 检查用户是否登录</span><br><span class="line">if(!empty($username)&amp;&amp;!empty($password))&#123;</span><br><span class="line">	// 连接数据库</span><br><span class="line">	$conn=new mysqli(&apos;localhost&apos;,$username,$password,&apos;testdb&apos;);</span><br><span class="line">	if($conn-&gt;connect_error)&#123;</span><br><span class="line">		if($dbname==&quot;lincRNA_h&quot;||$dbname==&quot;lincRNA_m&quot;)&#123;</span><br><span class="line">			header(&quot;Location:databaseQuery_Ano.php?err=3&quot;);</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">			header(&quot;Location:databaseQuery_DiffExp.php?err=3&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 根据id或dbname，从数据库中检索出相应的记录</span><br><span class="line">	// 构造SQL查询语句</span><br><span class="line">	$sql=&quot;SELECT * from $dbname where id=$id&quot;;</span><br><span class="line">	// 执行查询命令</span><br><span class="line">	$result = $conn-&gt;query($sql);</span><br><span class="line">	</span><br><span class="line">	// 选择对应的updata操作脚本名</span><br><span class="line">	if($dbname==&quot;lincRNA_h&quot;||$dbname==&quot;lincRNA_m&quot;)&#123;</span><br><span class="line">		$phpscript=&quot;update_operate_Ano.php&quot;;</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		$phpscript=&quot;update_operate_DiffExp.php&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// 将查询结果以表单形式呈现</span><br><span class="line">	if($result-&gt;num_rows &gt; 0)&#123;</span><br><span class="line">		echo &quot;&lt;form action=\&quot;&quot;.$phpscript.&quot;?id=&quot;.$id.&quot;&amp;dbname=&quot;.$dbname.&quot;\&quot; method=\&quot;post\&quot;&gt;\n&quot;;</span><br><span class="line">		echo &quot;&lt;table&gt;\n&lt;tr&gt;\n\t&lt;th&gt;Feature&lt;/th&gt;&lt;th&gt;Value&lt;/th&gt;\n&lt;/tr&gt;\n&quot;;</span><br><span class="line">		$row = $result-&gt;fetch_array();</span><br><span class="line">		// 遍历关联数组的每一个元素，并将它们填到表单里</span><br><span class="line">		foreach($row as $key=&gt;$key_value)&#123;</span><br><span class="line">			if(is_numeric($key)||$key==&quot;id&quot;)&#123;</span><br><span class="line">				continue;</span><br><span class="line">			&#125;</span><br><span class="line">			echo &quot;&lt;tr&gt;\n&quot;;</span><br><span class="line">			echo &quot;\t&lt;td&gt;&quot;.$key.&quot;&lt;/td&gt;\n&quot;;</span><br><span class="line">			echo &quot;\t&lt;td&gt;&lt;input type=\&quot;text\&quot; name=\&quot;&quot;.$key.&quot;\&quot; value=\&quot;&quot;.$key_value.&quot;\&quot;&gt;&lt;/td&gt;\n&lt;/tr&gt;&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">		// 表单的submit和reset按钮</span><br><span class="line">		echo &quot;&lt;tr&gt;\n\t&lt;td align=\&quot;center\&quot;&gt;&lt;input type=\&quot;submit\&quot; name=\&quot;submit\&quot; value=\&quot;Submit\&quot;&gt;&lt;/td&gt;\n&quot;;</span><br><span class="line">		echo &quot;\t&lt;td align=\&quot;center\&quot;&gt;&lt;input type=\&quot;reset\&quot; value=\&quot;Reset\&quot;&gt;&lt;/td&gt;\n&lt;/tr&gt;\n&quot;;</span><br><span class="line">		// 提示任务执行状态：成功或失败</span><br><span class="line">		echo &quot;&lt;tr&gt;\n\t&lt;td style=\&quot;color:red; font-size:10px;\&quot;&gt;&quot;;</span><br><span class="line">		switch($statu) &#123;</span><br><span class="line">			case 1:</span><br><span class="line">				echo &quot;该记录已修改成功！&quot;;</span><br><span class="line">			case 2:</span><br><span class="line">				echo &quot;该记录修改失败！&quot;;</span><br><span class="line">			case 3:</span><br><span class="line">				echo &quot;修改数据类型不符合格式要求，请重新填写！&quot;;</span><br><span class="line">			case 4:</span><br><span class="line">				echo &quot;未登陆，没有修改权限！请&lt;a href=\&quot;login.php\&quot;&gt;登陆&lt;/a&gt;&quot;;</span><br><span class="line">		&#125;</span><br><span class="line">		echo &quot;&lt;/td&gt;\n&lt;/tr&gt;\n&quot;;</span><br><span class="line">		echo &quot;&lt;/table&gt;\n&lt;/form&gt;\n&quot;;</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		if($dbname==&quot;lincRNA_h&quot;||$dbname==&quot;lincRNA_m&quot;)&#123;</span><br><span class="line">			header(&quot;Location:databaseQuery_Ano.php?err=4&quot;);</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">			header(&quot;Location:databaseQuery_DiffExp.php?err=4&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	if($dbname==&quot;lincRNA_h&quot;||$dbname==&quot;lincRNA_m&quot;)&#123;</span><br><span class="line">		header(&quot;Location:databaseQuery_Ano.php?err=3&quot;);</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		header(&quot;Location:databaseQuery_DiffExp.php?err=3&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>脚本<code>update_operate_Ano.php</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//开启session</span><br><span class="line">session_start();</span><br><span class="line">// 获取用户名和密码</span><br><span class="line">$username=isset($_SESSION[&apos;user&apos;])?$_SESSION[&apos;user&apos;]:&quot;&quot;;</span><br><span class="line">$password=isset($_SESSION[&apos;password&apos;])?$_SESSION[&apos;password&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">// 获取通过GET方法向该脚本传递的变量</span><br><span class="line">$id=isset($_GET[&apos;id&apos;])?$_GET[&apos;id&apos;]:&quot;&quot;;</span><br><span class="line">$dbname=isset($_GET[&apos;dbname&apos;])?$_GET[&apos;dbname&apos;]:&quot;&quot;;</span><br><span class="line">// 获取通过POST方法向该脚本传递的变量</span><br><span class="line">$chrom=isset($_POST[&apos;chrom&apos;])?$_POST[&apos;chrom&apos;]:&quot;&quot;;</span><br><span class="line">$biotype=isset($_POST[&apos;biotype&apos;])?$_POST[&apos;biotype&apos;]:&quot;&quot;;</span><br><span class="line">$feature=isset($_POST[&apos;feature&apos;])?$_POST[&apos;feature&apos;]:&quot;&quot;;</span><br><span class="line">$start=isset($_POST[&apos;start&apos;])?$_POST[&apos;start&apos;]:&quot;&quot;;</span><br><span class="line">$end=isset($_POST[&apos;end&apos;])?$_POST[&apos;end&apos;]:&quot;&quot;;</span><br><span class="line">$geneid=isset($_POST[&apos;geneid&apos;])?$_POST[&apos;geneid&apos;]:&quot;&quot;;</span><br><span class="line">$genename=isset($_POST[&apos;genename&apos;])?$_POST[&apos;genename&apos;]:&quot;&quot;;</span><br><span class="line">$transcriptid=isset($_POST[&apos;transcriptid&apos;])?$_POST[&apos;transcriptid&apos;]:&quot;&quot;;</span><br><span class="line">$exon=isset($_POST[&apos;exon&apos;])?$_POST[&apos;exon&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">// 进行提交数据的格式检查</span><br><span class="line">$bool_mark=1;</span><br><span class="line">// 检查chrom，是否为1-22或XY</span><br><span class="line">if(!preg_match(&quot;\d&#123;1,2&#125;|[XY]&quot;,$chrom))&#123;</span><br><span class="line">	$bool_mark=0;</span><br><span class="line">&#125;</span><br><span class="line">// 检查biotype和feature，是否都是英文字母</span><br><span class="line">if(!preg_match(&quot;[a-zA-Z]&quot;,$biotype)||!preg_match(&quot;[a-zA-Z]&quot;,$feature))&#123;</span><br><span class="line">	$bool_mark=0;</span><br><span class="line">&#125;</span><br><span class="line">// 检查start、end和exon，是否是数字</span><br><span class="line">if(!is_numeric($start)||!is_numeric($end)||!is_numeric($exon))&#123;</span><br><span class="line">	$bool_mark=0;</span><br><span class="line">&#125;</span><br><span class="line">// 检查GeneId和TranscriptId,是否以ENSG或ENSG打头</span><br><span class="line">if(!preg_match(&quot;^ENSG&quot;,$geneid)||!preg_match(&quot;^(ENST)|-&quot;,$transcriptid))&#123;</span><br><span class="line">	$bool_mark=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 若用户提交的修改申请不符合格式要求，则返回update表单填写页面，并提示错误信息</span><br><span class="line">if(!$bool_mark)&#123;</span><br><span class="line">	header(&quot;Location:update_form.php?statu=3&quot;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	// 判断用户名和密码是否已经设置</span><br><span class="line">	if(!empty($username)&amp;&amp;!empty($password))&#123;</span><br><span class="line">		// 连接数据库</span><br><span class="line">		$conn=new mysqli(&apos;localhost&apos;,$username,$password,&apos;testdb&apos;);</span><br><span class="line">		if($conn-&gt;connect_error)&#123;</span><br><span class="line">			header(&quot;Location:update_form.php?statu=4&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		// 创建SQL的UPDATE语句</span><br><span class="line">		$sql=&quot;UPDATE $dbname SET chrom=&apos;$chrom&apos;,biotype=&apos;$biotype&apos;,feature=&apos;$feature&apos;,start=$start,end=$end,geneid=&apos;$geneid&apos;,genename=&apos;$genename&apos;,transcriptid=&apos;$transcriptid&apos;,exon=$exon where id=$id;&quot;;</span><br><span class="line">		</span><br><span class="line">		// 执行SQL语句</span><br><span class="line">		if($conn-&gt;query($sql)===TRUE)&#123;</span><br><span class="line">			header(&quot;Location:update_form.php?statu=1&quot;);</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">			header(&quot;Location:update_form.php?statu=2&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		header(&quot;Location:update_form.php?statu=3&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>脚本<code>updata_operate_DiffExp.php</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//开启session</span><br><span class="line">session_start();</span><br><span class="line">// 获取用户名和密码</span><br><span class="line">$username=isset($_SESSION[&apos;user&apos;])?$_SESSION[&apos;user&apos;]:&quot;&quot;;</span><br><span class="line">$password=isset($_SESSION[&apos;password&apos;])?$_SESSION[&apos;password&apos;]:&quot;&quot;;</span><br><span class="line"></span><br><span class="line">// 获取通过GET方法向该脚本传递的变量</span><br></pre></td></tr></table></figure>
<h1 id="番外篇：前端优化——html-css"><a href="#番外篇：前端优化——html-css" class="headerlink" title="番外篇：前端优化——html+css"></a>番外篇：前端优化——html+css</h1><h2 id="登录界面优化"><a href="#登录界面优化" class="headerlink" title="登录界面优化"></a>登录界面优化</h2><p>实现效果：</p>
<blockquote>
<p>山寨主流网站的登录界面，即将页面分为左右两半，左侧放置图片，右侧放置登录信息输入框</p>
</blockquote>
<p><img src="/images/InAction-PHP-MySQL-part3-login-ui.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;登录&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">/* 设置背景色：碧绿色 */</span><br><span class="line">body&#123;</span><br><span class="line">	background-color:#7FFFAA;</span><br><span class="line">	margin:50px;</span><br><span class="line">&#125;</span><br><span class="line">form &#123;</span><br><span class="line">	background-color:white;</span><br><span class="line">	width:100%;</span><br><span class="line">	margin:auto;</span><br><span class="line">	padding:70px 0;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">	&lt;div style=&quot;float:left; width:50%; height:100%;&quot;&gt;</span><br><span class="line">		&lt;img src=./picture/lncRNAdb-logo.jpg width=100% /&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">	&lt;div style=&quot;float:right; width:50%; height:100%;&quot;&gt;</span><br><span class="line">	.</span><br><span class="line">	.</span><br><span class="line">	.</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<h2 id="导航条菜单的制作"><a href="#导航条菜单的制作" class="headerlink" title="导航条菜单的制作"></a>导航条菜单的制作</h2><p>实现效果：</p>
<blockquote>
<p>将页面分为左右部分，左侧放置垂直导航栏，右侧放置主面板</p>
</blockquote>
<p><img src="/images/InAction-PHP-MySQL-part3-page-with-navigation.png" alt></p>
<p>使用外部css制定页面渲染风格，css文件保存为<code>private.css</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">/* 导航栏样式 */</span><br><span class="line">/* 页面左侧主导航栏（垂直导航栏），占据页面左侧10%的空间，且位置固定 */</span><br><span class="line">.nav_vertical &#123;</span><br><span class="line">	margin:0;</span><br><span class="line">	padding:0;</span><br><span class="line">	width:10%;</span><br><span class="line">	list-style-type:none;</span><br><span class="line">	background-color: #f1f1f1;</span><br><span class="line">	position: fixed;</span><br><span class="line">	height: 100%;</span><br><span class="line">&#125;</span><br><span class="line">.nav_vertical li a&#123;</span><br><span class="line">	display:block;</span><br><span class="line">	padding: 8px 16px;</span><br><span class="line">	text-decoration:none;</span><br><span class="line">	color: #000;	/*  字体颜色：灰色 */</span><br><span class="line">&#125;</span><br><span class="line">.nav_vertical li a:hover&#123;	/* 鼠标悬停时链接块颜色：橙色 */</span><br><span class="line">	background-color:#F60;</span><br><span class="line">	color:#fff</span><br><span class="line">&#125;</span><br><span class="line">.nav_vertical li a.active&#123;	</span><br><span class="line">	background-color: #4CAF50;	/*  激活的链接块颜色：绿色 */</span><br><span class="line">	color:#fff;</span><br><span class="line">&#125;</span><br><span class="line">/* 页面右侧子导航栏（水平导航栏），用于在进行数据库检索时，在不同数据库间切换 */</span><br><span class="line">.nav_horizontal &#123;</span><br><span class="line">	margin-left:10px;</span><br><span class="line">	padding:0;</span><br><span class="line">	list-style-type:none;</span><br><span class="line">&#125;</span><br><span class="line">.nav_horizontal li &#123;</span><br><span class="line">	display:inline;</span><br><span class="line">&#125;</span><br><span class="line">.nav_horizontal li a&#123;</span><br><span class="line">	padding: 8px 16px;</span><br><span class="line">	text-decoration:none;</span><br><span class="line">	background-color: #f1f1f1;</span><br><span class="line">	color: #000;	/*  字体颜色：灰色 */</span><br><span class="line">&#125;</span><br><span class="line">.nav_horizontal li a:hover&#123;	/* 鼠标悬停时链接块颜色：橙色 */</span><br><span class="line">	background-color:#F60;</span><br><span class="line">	color:#fff</span><br><span class="line">&#125;</span><br><span class="line">.nav_horizontal li a.active&#123;	</span><br><span class="line">	background-color: #4CAF50;	/*  激活的链接块颜色：绿色 */</span><br><span class="line">	color:#fff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 链接样式 */</span><br><span class="line">a:link &#123;color:#0000FF;text-decoration:none;&#125; /* 蓝色 */</span><br><span class="line">a:visited &#123;color:#778899;text-decoration:none;&#125; /* 灰色 */</span><br><span class="line">a:hover &#123;color:#000000;text-decoration:none;&#125; /* 黑色 */</span><br><span class="line">a:active &#123;color:#FF704D;text-decoration:none;&#125;</span><br><span class="line"></span><br><span class="line">/* 表格样式 */</span><br><span class="line">/* 检索表单部分表格样式 */</span><br><span class="line">.result &#123;border-collapse:collapse;&#125;</span><br><span class="line">table,th,td &#123;border:1px solid black;&#125;</span><br><span class="line">th &#123;width:100%;height:50px;&#125;</span><br></pre></td></tr></table></figure>
<p>则在每个php脚本前加入以下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;head&gt;</span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;private.css&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;ul class=&quot;nav_vertical&quot;&gt;</span><br><span class="line">  	&lt;li&gt;&lt;a class=&quot;active&quot; href=&quot;loginsucc.php&quot;&gt;主页&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">  	&lt;li&gt;&lt;a href=&quot;databaseQuery_Ano.php&quot;&gt;检索&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">  	&lt;li&gt;&lt;a href=&quot;batch_submit_data.php&quot;&gt;提交数据&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">	&lt;li&gt;&lt;a href=&quot;#&quot;&gt;BLAST&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">	&lt;li&gt;&lt;a href=&quot;help.html&quot;&gt;帮助&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">	&lt;li&gt;&lt;a href=&quot;logout.php&quot;&gt;退出&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;div style=&quot;margin-left:10%; padding:10px; height:100%;&quot;&gt;</span><br><span class="line">&lt;!-- 若为检索部分，请添加以下部分代码 --&gt;</span><br><span class="line">&lt;!-- &lt;ul class=&quot;nav_horizontal&quot;&gt;</span><br><span class="line">  	&lt;li&gt;&lt;a class=&quot;active&quot; href=&quot;databaseQuery_Ano.php&quot;&gt;基因结构注释&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">  	&lt;li&gt;&lt;a href=&quot;databaseQuery_DiffExp.php&quot;&gt;基因表达谱&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt; --&gt;</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<hr>
<p>参考资料：</p>
<p>(1) <a href="https://www.fenxd.com/111.html" target="_blank" rel="noopener">PHP+MySQLi实现注册和登陆</a></p>
<p><a name="nat-pro">(2) Pertea M, Kim D, Pertea G M, et al. Transcript-level expression analysis of RNA-seq experiments with HISAT, StringTie and Ballgown[J]. Nature Protocols, 2016, 11(9):1650.</a></p>
<p>(3) <a href="https://github.com/Ming-Lian/NGS-analysis/blob/master/RNA-seq.md" target="_blank" rel="noopener">Analysis pipeline for RNA-seq</a></p>
<p>(4) <a href="http://www.w3school.com.cn/sql/sql_datatypes.asp" target="_blank" rel="noopener">W3School：SQL 数据类型</a></p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/PHP/" rel="tag"># PHP</a>
          
            <a href="/tags/MySQL/" rel="tag"># MySQL</a>
          
            <a href="/tags/CSS/" rel="tag"># CSS</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/02/09/Load-and-resolve-MarkdownDoc/" rel="next" title="前端小技巧：加载并解析Markdown文档">
                <i class="fa fa-chevron-left"></i> 前端小技巧：加载并解析Markdown文档
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/02/17/MeRIP-seq/" rel="prev" title="MeRIP/ChIP-seq分析流程">
                MeRIP/ChIP-seq分析流程 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Lianm">
            
              <p class="site-author-name" itemprop="name">Lianm</p>
              <p class="site-description motion-element" itemprop="description">中国科学院北京基因组研究所研究生</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">29</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">31</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/Ming-Lian" title="GitHub &rarr; https://github.com/Ming-Lian" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:lianming17m@big.ac.cn" title="E-Mail &rarr; mailto:lianming17m@big.ac.cn" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.jianshu.com/u/42e711970fa8" title="简书 &rarr; https://www.jianshu.com/u/42e711970fa8" rel="noopener" target="_blank"><i class="fa fa-fw fa-jianshu"></i>简书</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.zhihu.com/people/understorm" title="知乎 &rarr; https://www.zhihu.com/people/understorm" rel="noopener" target="_blank"><i class="fa fa-fw fa-zhihu"></i>知乎</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Part1：lincRNA注释信息数据库"><span class="nav-text">Part1：lincRNA注释信息数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#实现目标"><span class="nav-text">实现目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#思路"><span class="nav-text">思路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#准备需要写入数据库中的数据"><span class="nav-text">准备需要写入数据库中的数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#下载注释信息文件"><span class="nav-text">下载注释信息文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#提取lincRNA部分记录"><span class="nav-text">提取lincRNA部分记录</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#将数据写入数据库中"><span class="nav-text">将数据写入数据库中</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#方法一：使用MySQLi"><span class="nav-text">方法一：使用MySQLi</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法二：使用sql脚本"><span class="nav-text">方法二：使用sql脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#准备sql脚本"><span class="nav-text">准备sql脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#写入数据"><span class="nav-text">写入数据</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编辑php脚本"><span class="nav-text">编辑php脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#注册"><span class="nav-text">注册</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建注册页面"><span class="nav-text">创建注册页面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#注册信息处理脚本"><span class="nav-text">注册信息处理脚本</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#登录"><span class="nav-text">登录</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#登录页面"><span class="nav-text">登录页面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#登录脚本"><span class="nav-text">登录脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#登录成功"><span class="nav-text">登录成功</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#退出登录"><span class="nav-text">退出登录</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检索数据库"><span class="nav-text">检索数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#表单部分"><span class="nav-text">表单部分</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PHP脚本"><span class="nav-text">PHP脚本</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Part2：内容与功能升级"><span class="nav-text">Part2：内容与功能升级</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#实现目标-1"><span class="nav-text">实现目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#思路-1"><span class="nav-text">思路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#添加blast功能"><span class="nav-text">添加blast功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#获得chrX上lincRNA序列"><span class="nav-text">获得chrX上lincRNA序列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#构建BLAST索引"><span class="nav-text">构建BLAST索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行BLAST"><span class="nav-text">执行BLAST</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#添加lincRNA表达谱"><span class="nav-text">添加lincRNA表达谱</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#获取在两个样本组的表达谱"><span class="nav-text">获取在两个样本组的表达谱</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#数据集简单介绍与下载"><span class="nav-text">数据集简单介绍与下载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#跑RNA-seq分析流程"><span class="nav-text">跑RNA-seq分析流程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将差异表达结果写进MySQL"><span class="nav-text">将差异表达结果写进MySQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#检索表达谱数据库"><span class="nav-text">检索表达谱数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#画图：单个基因表达谱"><span class="nav-text">画图：单个基因表达谱</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#添加批量提交数据功能"><span class="nav-text">添加批量提交数据功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#添加Update功能"><span class="nav-text">添加Update功能</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#番外篇：前端优化——html-css"><span class="nav-text">番外篇：前端优化——html+css</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#登录界面优化"><span class="nav-text">登录界面优化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#导航条菜单的制作"><span class="nav-text">导航条菜单的制作</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lianm</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.0.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>



  
  











  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/three/three.min.js"></script>

  
  <script src="/lib/three/three-waves.min.js"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.0"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.0"></script>
<script src="/js/src/post-details.js?v=7.0.0"></script>



  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>



  


  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  


  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js'; 
      }
      else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  

  

  

  

  

</body>
</html>
